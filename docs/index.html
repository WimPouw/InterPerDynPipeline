<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.29">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Arkadiusz Białek">
<meta name="author" content="Wim Pouw">
<meta name="author" content="Travis J. Wiltshire">
<meta name="author" content="James Trujillo">
<meta name="author" content="Fred Hasselman">
<meta name="author" content="Babajide Alamu Owoyele">
<meta name="author" content="Natalia Siekiera">
<meta name="author" content="Joanna Rączaszek-Leonardi">
<meta name="dcterms.date" content="2025-05-12">

<title>An Open-source Standardized Pipeline for Tracing the Behavioral Dynamics in Social Interactions</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="index_files/libs/clipboard/clipboard.min.js"></script>
<script src="index_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="index_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="index_files/libs/quarto-html/popper.min.js"></script>
<script src="index_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="index_files/libs/quarto-html/anchor.min.js"></script>
<link href="index_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="index_files/libs/quarto-html/quarto-syntax-highlighting-0815c480559380816a4d1ea211a47e91.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="index_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="index_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="index_files/libs/bootstrap/bootstrap-84b3b4cc5777f6fdbd4d01919023a4cd.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">


<link rel="stylesheet" href="quarto_dependencies/styles/styles.css">
</head>

<body class="fullcontent quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">An Open-source Standardized Pipeline for Tracing the Behavioral Dynamics in Social Interactions</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
<p class="subtitle lead">Computationally Reproducible Extended Methods Section</p>
</div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Authors</div>
  <div class="quarto-title-meta-heading">Affiliations</div>
  
    <div class="quarto-title-meta-contents">
    <p class="author">Arkadiusz Białek </p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            Jagiellonian University, Poland
          </p>
      </div>
    <div class="quarto-title-meta-contents">
    <p class="author">Wim Pouw </p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            Tilburg University, Netherlands
          </p>
      </div>
    <div class="quarto-title-meta-contents">
    <p class="author">Travis J. Wiltshire </p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            Tilburg University, Netherlands
          </p>
      </div>
    <div class="quarto-title-meta-contents">
    <p class="author">James Trujillo </p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            University of Amsterdam, USA
          </p>
      </div>
    <div class="quarto-title-meta-contents">
    <p class="author">Fred Hasselman </p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            Radboud University, Netherlands
          </p>
      </div>
    <div class="quarto-title-meta-contents">
    <p class="author">Babajide Alamu Owoyele </p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            Hasso Plattner Institute, University of Potsdam, Germany
          </p>
      </div>
    <div class="quarto-title-meta-contents">
    <p class="author">Natalia Siekiera </p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            Jagiellonian University, Poland
          </p>
      </div>
    <div class="quarto-title-meta-contents">
    <p class="author">Joanna Rączaszek-Leonardi </p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            University of Warsaw, Poland
          </p>
      </div>
  </div>

<div class="quarto-title-meta">

      
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">May 12, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<p><img src="images/ts.gif" class="img-fluid"></p>
<section id="overview" class="level1">
<h1>Overview</h1>
<p>To increase privacy we apply maskanyone <span class="citation" data-cites="owoyeleMaskAnyoneToolkitOffering2024">(<a href="#ref-owoyeleMaskAnyoneToolkitOffering2024" role="doc-biblioref">Owoyele et al. 2024</a>)</span>.</p>
</section>
<section id="dataset" class="level1">
<h1>Dataset</h1>
<p>The following data has been made available in masked form.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Download Guide ⬇️
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>The masked data can be downloaded from the repository of Jagellonian University <a href="">here</a>. The unmasked data can be requested from the authors. The unmasked data is not available in this repository for privacy reasons.</p>
</div>
</div>
</div>
<section id="dataset-mother-infant" class="level3">
<h3 class="anchored" data-anchor-id="dataset-mother-infant">Dataset Mother Infant</h3>
<div class="cell" data-code_folding="hide">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>matplotlib.use(<span class="st">'agg'</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>plt.ioff()</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>plt.clf() <span class="co"># Clear any existing figures</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the data</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">'./meta/project_point_metadata_ages.csv'</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert gender to categorical label</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'gender_label'</span>] <span class="op">=</span> df[<span class="st">'gender'</span>].<span class="bu">map</span>({<span class="dv">0</span>: <span class="st">'Female'</span>, <span class="dv">1</span>: <span class="st">'Male'</span>})</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a 2x2 subplot layout</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">10</span>), gridspec_kw<span class="op">=</span>{<span class="st">'width_ratios'</span>: [<span class="fl">1.5</span>, <span class="dv">1</span>], <span class="st">'height_ratios'</span>: [<span class="fl">1.5</span>, <span class="dv">1</span>]})</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>fig.suptitle(<span class="st">'Mother-Infant Dataset Overview'</span>, fontsize<span class="op">=</span><span class="dv">16</span>, fontfamily<span class="op">=</span><span class="st">'serif'</span>)</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Define colors for gender</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>colors <span class="op">=</span> {</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Female'</span>: <span class="st">'#C55A11'</span>,   <span class="co"># Orange for females</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Male'</span>: <span class="st">'#4472C4'</span>       <span class="co"># Blue for males</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Line plot - Age progression across time points</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx, row <span class="kw">in</span> df.iterrows():</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>    gender <span class="op">=</span> row[<span class="st">'gender_label'</span>]</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create arrays for days and time points, handling NaN values</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>    days <span class="op">=</span> []</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>    timepoints <span class="op">=</span> []</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">8</span>):   <span class="co"># T1 to T7</span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>        day_col <span class="op">=</span> <span class="ss">f'age_T</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">_days'</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> day_col <span class="kw">in</span> df.columns <span class="kw">and</span> pd.notna(row[day_col]) <span class="kw">and</span> row[day_col] <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>            days.append(row[day_col])</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>            timepoints.append(i)</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Plot the line for this infant</span></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>    axs[<span class="dv">0</span>, <span class="dv">0</span>].plot(</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>        timepoints,</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>        days,</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>        marker<span class="op">=</span><span class="st">'o'</span>,</span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>        color<span class="op">=</span>colors[gender],</span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>        alpha<span class="op">=</span><span class="fl">0.5</span>,</span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>        linewidth<span class="op">=</span><span class="fl">1.5</span></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a><span class="co"># Customize the plot</span></span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>, <span class="dv">0</span>].set_xlabel(<span class="st">'Time Point'</span>, fontfamily<span class="op">=</span><span class="st">'serif'</span>)</span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>, <span class="dv">0</span>].set_ylabel(<span class="st">'Age (days)'</span>, fontfamily<span class="op">=</span><span class="st">'serif'</span>)</span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>, <span class="dv">0</span>].set_title(<span class="st">'Infant Age Progression'</span>, fontfamily<span class="op">=</span><span class="st">'serif'</span>)</span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>, <span class="dv">0</span>].set_xticks(<span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">8</span>))</span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>, <span class="dv">0</span>].set_xticklabels([<span class="ss">f'T</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">'</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">8</span>)])</span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>, <span class="dv">0</span>].grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a><span class="co"># Add legend patches</span></span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib.patches <span class="im">import</span> Patch</span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>legend_elements <span class="op">=</span> [</span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>    Patch(facecolor<span class="op">=</span>colors[<span class="st">'Female'</span>], edgecolor<span class="op">=</span><span class="st">'w'</span>, label<span class="op">=</span><span class="st">'Female'</span>),</span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>    Patch(facecolor<span class="op">=</span>colors[<span class="st">'Male'</span>], edgecolor<span class="op">=</span><span class="st">'w'</span>, label<span class="op">=</span><span class="st">'Male'</span>)</span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>, <span class="dv">0</span>].legend(handles<span class="op">=</span>legend_elements, loc<span class="op">=</span><span class="st">'upper left'</span>)</span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Box plot - Age distribution at each time point</span></span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a>time_point_data <span class="op">=</span> []</span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a>labels <span class="op">=</span> []</span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">8</span>):   <span class="co"># T1 to T7</span></span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a>    col <span class="op">=</span> <span class="ss">f'age_T</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">_days'</span></span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> col <span class="kw">in</span> df.columns:</span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a>        valid_data <span class="op">=</span> df[col].dropna()</span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(valid_data) <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a>            time_point_data.append(valid_data)</span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a>            labels.append(<span class="ss">f'T</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a><span class="co"># Create violin plots</span></span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> time_point_data:</span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a>    violin_parts <span class="op">=</span> axs[<span class="dv">0</span>, <span class="dv">1</span>].violinplot(</span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a>        time_point_data,</span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a>        showmeans<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a>        showmedians<span class="op">=</span><span class="va">True</span></span>
<span id="cb1-84"><a href="#cb1-84" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb1-85"><a href="#cb1-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-86"><a href="#cb1-86" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Color the violin plots</span></span>
<span id="cb1-87"><a href="#cb1-87" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, pc <span class="kw">in</span> <span class="bu">enumerate</span>(violin_parts[<span class="st">'bodies'</span>]):</span>
<span id="cb1-88"><a href="#cb1-88" aria-hidden="true" tabindex="-1"></a>        pc.set_facecolor(<span class="st">'#7030A0'</span>)  <span class="co"># Purple</span></span>
<span id="cb1-89"><a href="#cb1-89" aria-hidden="true" tabindex="-1"></a>        pc.set_edgecolor(<span class="st">'black'</span>)</span>
<span id="cb1-90"><a href="#cb1-90" aria-hidden="true" tabindex="-1"></a>        pc.set_alpha(<span class="fl">0.7</span>)</span>
<span id="cb1-91"><a href="#cb1-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-92"><a href="#cb1-92" aria-hidden="true" tabindex="-1"></a><span class="co"># Set labels</span></span>
<span id="cb1-93"><a href="#cb1-93" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>, <span class="dv">1</span>].set_xticks(<span class="bu">range</span>(<span class="dv">1</span>, <span class="bu">len</span>(labels) <span class="op">+</span> <span class="dv">1</span>))</span>
<span id="cb1-94"><a href="#cb1-94" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>, <span class="dv">1</span>].set_xticklabels(labels)</span>
<span id="cb1-95"><a href="#cb1-95" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>, <span class="dv">1</span>].set_xlabel(<span class="st">'Time Point'</span>, fontfamily<span class="op">=</span><span class="st">'serif'</span>)</span>
<span id="cb1-96"><a href="#cb1-96" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>, <span class="dv">1</span>].set_ylabel(<span class="st">'Age (days)'</span>, fontfamily<span class="op">=</span><span class="st">'serif'</span>)</span>
<span id="cb1-97"><a href="#cb1-97" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>, <span class="dv">1</span>].set_title(<span class="st">'Age Distribution by Time Point'</span>, fontfamily<span class="op">=</span><span class="st">'serif'</span>)</span>
<span id="cb1-98"><a href="#cb1-98" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>, <span class="dv">1</span>].grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>, axis<span class="op">=</span><span class="st">'y'</span>)</span>
<span id="cb1-99"><a href="#cb1-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-100"><a href="#cb1-100" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Pie chart - Gender distribution</span></span>
<span id="cb1-101"><a href="#cb1-101" aria-hidden="true" tabindex="-1"></a>gender_counts <span class="op">=</span> df[<span class="st">'gender_label'</span>].value_counts()</span>
<span id="cb1-102"><a href="#cb1-102" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>, <span class="dv">0</span>].pie(</span>
<span id="cb1-103"><a href="#cb1-103" aria-hidden="true" tabindex="-1"></a>    gender_counts,</span>
<span id="cb1-104"><a href="#cb1-104" aria-hidden="true" tabindex="-1"></a>    labels<span class="op">=</span>gender_counts.index,</span>
<span id="cb1-105"><a href="#cb1-105" aria-hidden="true" tabindex="-1"></a>    autopct<span class="op">=</span><span class="st">'</span><span class="sc">%1.1f%%</span><span class="st">'</span>,</span>
<span id="cb1-106"><a href="#cb1-106" aria-hidden="true" tabindex="-1"></a>    colors<span class="op">=</span>[colors[g] <span class="cf">for</span> g <span class="kw">in</span> gender_counts.index],</span>
<span id="cb1-107"><a href="#cb1-107" aria-hidden="true" tabindex="-1"></a>    wedgeprops<span class="op">=</span>{<span class="st">'edgecolor'</span>: <span class="st">'w'</span>, <span class="st">'linewidth'</span>: <span class="dv">1</span>}</span>
<span id="cb1-108"><a href="#cb1-108" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-109"><a href="#cb1-109" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>, <span class="dv">0</span>].set_title(<span class="st">'Gender Distribution'</span>, fontfamily<span class="op">=</span><span class="st">'serif'</span>)</span>
<span id="cb1-110"><a href="#cb1-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-111"><a href="#cb1-111" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Summary table</span></span>
<span id="cb1-112"><a href="#cb1-112" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate averages for each time point, handling NaN values</span></span>
<span id="cb1-113"><a href="#cb1-113" aria-hidden="true" tabindex="-1"></a>averages_days <span class="op">=</span> []</span>
<span id="cb1-114"><a href="#cb1-114" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">8</span>):</span>
<span id="cb1-115"><a href="#cb1-115" aria-hidden="true" tabindex="-1"></a>    col <span class="op">=</span> <span class="ss">f'age_T</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">_days'</span></span>
<span id="cb1-116"><a href="#cb1-116" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> col <span class="kw">in</span> df.columns:</span>
<span id="cb1-117"><a href="#cb1-117" aria-hidden="true" tabindex="-1"></a>        avg <span class="op">=</span> df[col].mean()</span>
<span id="cb1-118"><a href="#cb1-118" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> pd.isna(avg):</span>
<span id="cb1-119"><a href="#cb1-119" aria-hidden="true" tabindex="-1"></a>            avg_months <span class="op">=</span> avg <span class="op">/</span> <span class="fl">30.44</span>  <span class="co"># Convert to months</span></span>
<span id="cb1-120"><a href="#cb1-120" aria-hidden="true" tabindex="-1"></a>            averages_days.append([<span class="ss">f"T</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss"> Average Age"</span>, <span class="ss">f"</span><span class="sc">{</span>avg<span class="sc">:.1f}</span><span class="ss"> days (</span><span class="sc">{</span>avg_months<span class="sc">:.1f}</span><span class="ss"> months)"</span>])</span>
<span id="cb1-121"><a href="#cb1-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-122"><a href="#cb1-122" aria-hidden="true" tabindex="-1"></a><span class="co"># Count participants at each time point</span></span>
<span id="cb1-123"><a href="#cb1-123" aria-hidden="true" tabindex="-1"></a>participants <span class="op">=</span> []</span>
<span id="cb1-124"><a href="#cb1-124" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">8</span>):</span>
<span id="cb1-125"><a href="#cb1-125" aria-hidden="true" tabindex="-1"></a>    col <span class="op">=</span> <span class="ss">f'age_T</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">_days'</span></span>
<span id="cb1-126"><a href="#cb1-126" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> col <span class="kw">in</span> df.columns:</span>
<span id="cb1-127"><a href="#cb1-127" aria-hidden="true" tabindex="-1"></a>        count <span class="op">=</span> df[col].notna().<span class="bu">sum</span>()</span>
<span id="cb1-128"><a href="#cb1-128" aria-hidden="true" tabindex="-1"></a>        participants.append([<span class="ss">f"Participants at T</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">"</span>, <span class="ss">f"</span><span class="sc">{</span>count<span class="sc">}</span><span class="ss">"</span>])</span>
<span id="cb1-129"><a href="#cb1-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-130"><a href="#cb1-130" aria-hidden="true" tabindex="-1"></a><span class="co"># Overall statistics</span></span>
<span id="cb1-131"><a href="#cb1-131" aria-hidden="true" tabindex="-1"></a>summary_data <span class="op">=</span> [</span>
<span id="cb1-132"><a href="#cb1-132" aria-hidden="true" tabindex="-1"></a>    [<span class="st">"Total Infants"</span>, <span class="ss">f"</span><span class="sc">{</span><span class="bu">len</span>(df)<span class="sc">}</span><span class="ss">"</span>],</span>
<span id="cb1-133"><a href="#cb1-133" aria-hidden="true" tabindex="-1"></a>    [<span class="st">"Females"</span>, <span class="ss">f"</span><span class="sc">{</span>(df[<span class="st">'gender'</span>] <span class="op">==</span> <span class="dv">0</span>)<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">}</span><span class="ss">"</span>],</span>
<span id="cb1-134"><a href="#cb1-134" aria-hidden="true" tabindex="-1"></a>    [<span class="st">"Males"</span>, <span class="ss">f"</span><span class="sc">{</span>(df[<span class="st">'gender'</span>] <span class="op">==</span> <span class="dv">1</span>)<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">}</span><span class="ss">"</span>]</span>
<span id="cb1-135"><a href="#cb1-135" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb1-136"><a href="#cb1-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-137"><a href="#cb1-137" aria-hidden="true" tabindex="-1"></a><span class="co"># Add age ranges if columns exist</span></span>
<span id="cb1-138"><a href="#cb1-138" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="st">'age_T1_days'</span> <span class="kw">in</span> df.columns:</span>
<span id="cb1-139"><a href="#cb1-139" aria-hidden="true" tabindex="-1"></a>    summary_data.append([<span class="st">"Age Range T1"</span>, <span class="ss">f"</span><span class="sc">{</span>df[<span class="st">'age_T1_days'</span>]<span class="sc">.</span><span class="bu">min</span>()<span class="sc">:.0f}</span><span class="ss">-</span><span class="sc">{</span>df[<span class="st">'age_T1_days'</span>]<span class="sc">.</span><span class="bu">max</span>()<span class="sc">:.0f}</span><span class="ss"> days"</span>])</span>
<span id="cb1-140"><a href="#cb1-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-141"><a href="#cb1-141" aria-hidden="true" tabindex="-1"></a>last_tp <span class="op">=</span> <span class="dv">7</span></span>
<span id="cb1-142"><a href="#cb1-142" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> last_tp <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb1-143"><a href="#cb1-143" aria-hidden="true" tabindex="-1"></a>    col <span class="op">=</span> <span class="ss">f'age_T</span><span class="sc">{</span>last_tp<span class="sc">}</span><span class="ss">_days'</span></span>
<span id="cb1-144"><a href="#cb1-144" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> col <span class="kw">in</span> df.columns <span class="kw">and</span> df[col].notna().<span class="bu">sum</span>() <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb1-145"><a href="#cb1-145" aria-hidden="true" tabindex="-1"></a>        summary_data.append([<span class="ss">f"Age Range T</span><span class="sc">{</span>last_tp<span class="sc">}</span><span class="ss">"</span>, <span class="ss">f"</span><span class="sc">{</span>df[col]<span class="sc">.</span><span class="bu">min</span>()<span class="sc">:.0f}</span><span class="ss">-</span><span class="sc">{</span>df[col]<span class="sc">.</span><span class="bu">max</span>()<span class="sc">:.0f}</span><span class="ss"> days"</span>])</span>
<span id="cb1-146"><a href="#cb1-146" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span></span>
<span id="cb1-147"><a href="#cb1-147" aria-hidden="true" tabindex="-1"></a>    last_tp <span class="op">-=</span> <span class="dv">1</span></span>
<span id="cb1-148"><a href="#cb1-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-149"><a href="#cb1-149" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the table with the most important summary statistics</span></span>
<span id="cb1-150"><a href="#cb1-150" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>, <span class="dv">1</span>].axis(<span class="st">'off'</span>)</span>
<span id="cb1-151"><a href="#cb1-151" aria-hidden="true" tabindex="-1"></a>table <span class="op">=</span> axs[<span class="dv">1</span>, <span class="dv">1</span>].table(</span>
<span id="cb1-152"><a href="#cb1-152" aria-hidden="true" tabindex="-1"></a>    cellText<span class="op">=</span>summary_data <span class="op">+</span> participants,</span>
<span id="cb1-153"><a href="#cb1-153" aria-hidden="true" tabindex="-1"></a>    loc<span class="op">=</span><span class="st">'center'</span>,</span>
<span id="cb1-154"><a href="#cb1-154" aria-hidden="true" tabindex="-1"></a>    cellLoc<span class="op">=</span><span class="st">'left'</span></span>
<span id="cb1-155"><a href="#cb1-155" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-156"><a href="#cb1-156" aria-hidden="true" tabindex="-1"></a>table.auto_set_font_size(<span class="va">False</span>)</span>
<span id="cb1-157"><a href="#cb1-157" aria-hidden="true" tabindex="-1"></a>table.set_fontsize(<span class="dv">10</span>)</span>
<span id="cb1-158"><a href="#cb1-158" aria-hidden="true" tabindex="-1"></a>table.scale(<span class="dv">1</span>, <span class="fl">1.5</span>)</span>
<span id="cb1-159"><a href="#cb1-159" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>, <span class="dv">1</span>].set_title(<span class="st">'Dataset Summary'</span>, fontfamily<span class="op">=</span><span class="st">'serif'</span>)</span>
<span id="cb1-160"><a href="#cb1-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-161"><a href="#cb1-161" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb1-162"><a href="#cb1-162" aria-hidden="true" tabindex="-1"></a>plt.subplots_adjust(top<span class="op">=</span><span class="fl">0.9</span>)</span>
<span id="cb1-163"><a href="#cb1-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-164"><a href="#cb1-164" aria-hidden="true" tabindex="-1"></a><span class="co"># Save the figure to a file</span></span>
<span id="cb1-165"><a href="#cb1-165" aria-hidden="true" tabindex="-1"></a>output_path <span class="op">=</span> <span class="st">"images/mother_infant_analysis.png"</span></span>
<span id="cb1-166"><a href="#cb1-166" aria-hidden="true" tabindex="-1"></a>os.makedirs(os.path.dirname(output_path), exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb1-167"><a href="#cb1-167" aria-hidden="true" tabindex="-1"></a>plt.savefig(output_path, dpi<span class="op">=</span><span class="dv">300</span>, bbox_inches<span class="op">=</span><span class="st">'tight'</span>)</span>
<span id="cb1-168"><a href="#cb1-168" aria-hidden="true" tabindex="-1"></a>plt.close(fig) <span class="co"># Explicitly close the figure object</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/mother_infant_analysis.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="600"></p>
</figure>
</div>
<p>In our github repository we use a sample data from this dataset from an infant-mother pair whom we are allowed to share the video data for the current purposes.</p>
</section>
<section id="dataset-siblings" class="level3">
<h3 class="anchored" data-anchor-id="dataset-siblings">Dataset Siblings</h3>
<div class="cell" data-code_folding="hide">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the data</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">'./meta/project_siblings_metadata_ages_gender.csv'</span>)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Data preprocessing</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'AgeDifference'</span>] <span class="op">=</span> <span class="bu">abs</span>(df[<span class="st">'P1agedays'</span>] <span class="op">-</span> df[<span class="st">'P2agedays'</span>])</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'AverageAge'</span>] <span class="op">=</span> (df[<span class="st">'P1agedays'</span>] <span class="op">+</span> df[<span class="st">'P2agedays'</span>]) <span class="op">/</span> <span class="dv">2</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'GenderCombo'</span>] <span class="op">=</span> df[<span class="st">'GenderP1'</span>] <span class="op">+</span> <span class="st">'-'</span> <span class="op">+</span> df[<span class="st">'GenderP2'</span>]</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a 2x2 subplot layout</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">8</span>), gridspec_kw<span class="op">=</span>{<span class="st">'width_ratios'</span>: [<span class="fl">1.5</span>, <span class="dv">1</span>], <span class="st">'height_ratios'</span>: [<span class="fl">1.5</span>, <span class="dv">1</span>]})</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>fig.suptitle(<span class="st">'Sibling Dataset Overview'</span>, fontsize<span class="op">=</span><span class="dv">16</span>, fontfamily<span class="op">=</span><span class="st">'serif'</span>)</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Define colors for gender combinations</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>colors <span class="op">=</span> {</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">'M-M'</span>: <span class="st">'#4472C4'</span>,   <span class="co"># Blue</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">'M-F'</span>: <span class="st">'#7030A0'</span>,   <span class="co"># Purple</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">'F-M'</span>: <span class="st">'#548235'</span>,   <span class="co"># Green</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>    <span class="st">'F-F'</span>: <span class="st">'#C55A11'</span>    <span class="co"># Rust/Orange</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Scatter plot - P1 age vs P2 age</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> gender_combo, group <span class="kw">in</span> df.groupby(<span class="st">'GenderCombo'</span>):</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>    axs[<span class="dv">0</span>, <span class="dv">0</span>].scatter(</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>        group[<span class="st">'P1agedays'</span>],</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>        group[<span class="st">'P2agedays'</span>],</span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>        color<span class="op">=</span>colors.get(gender_combo, <span class="st">'gray'</span>),</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>        alpha<span class="op">=</span><span class="fl">0.7</span>,</span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>        label<span class="op">=</span>gender_combo,</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>        s<span class="op">=</span><span class="dv">50</span></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Add reference line</span></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>min_age <span class="op">=</span> <span class="bu">min</span>(df[<span class="st">'P1agedays'</span>].<span class="bu">min</span>(), df[<span class="st">'P2agedays'</span>].<span class="bu">min</span>())</span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>max_age <span class="op">=</span> <span class="bu">max</span>(df[<span class="st">'P1agedays'</span>].<span class="bu">max</span>(), df[<span class="st">'P2agedays'</span>].<span class="bu">max</span>())</span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>, <span class="dv">0</span>].plot([min_age, max_age], [min_age, max_age], <span class="st">'k--'</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>, <span class="dv">0</span>].set_xlabel(<span class="st">'P1 Age (days)'</span>, fontfamily<span class="op">=</span><span class="st">'serif'</span>)</span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>, <span class="dv">0</span>].set_ylabel(<span class="st">'P2 Age (days)'</span>, fontfamily<span class="op">=</span><span class="st">'serif'</span>)</span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>, <span class="dv">0</span>].set_title(<span class="st">'Participant Ages (P1 vs P2)'</span>, fontfamily<span class="op">=</span><span class="st">'serif'</span>)</span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>, <span class="dv">0</span>].grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>, <span class="dv">0</span>].legend()</span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Bar chart - Age differences</span></span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>bar_positions <span class="op">=</span> np.arange(<span class="bu">len</span>(df))</span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a>bar_width <span class="op">=</span> <span class="fl">0.8</span></span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>, <span class="dv">1</span>].bar(</span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a>    bar_positions,</span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'AgeDifference'</span>],</span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a>    width<span class="op">=</span>bar_width,</span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a>    color<span class="op">=</span>[colors.get(combo, <span class="st">'gray'</span>) <span class="cf">for</span> combo <span class="kw">in</span> df[<span class="st">'GenderCombo'</span>]]</span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>, <span class="dv">1</span>].set_xticks(bar_positions)</span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>, <span class="dv">1</span>].set_xticklabels(df[<span class="st">'Code'</span>], rotation<span class="op">=</span><span class="dv">90</span>)</span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>, <span class="dv">1</span>].set_xlabel(<span class="st">'Sibling Pair'</span>, fontfamily<span class="op">=</span><span class="st">'serif'</span>)</span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>, <span class="dv">1</span>].set_ylabel(<span class="st">'Age Difference (days)'</span>, fontfamily<span class="op">=</span><span class="st">'serif'</span>)</span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>, <span class="dv">1</span>].set_title(<span class="st">'Age Differences by Sibling Pair'</span>, fontfamily<span class="op">=</span><span class="st">'serif'</span>)</span>
<span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>, <span class="dv">1</span>].grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>, axis<span class="op">=</span><span class="st">'y'</span>)</span>
<span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Pie chart - Gender distribution</span></span>
<span id="cb2-64"><a href="#cb2-64" aria-hidden="true" tabindex="-1"></a>gender_counts <span class="op">=</span> df[<span class="st">'GenderCombo'</span>].value_counts()</span>
<span id="cb2-65"><a href="#cb2-65" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>, <span class="dv">0</span>].pie(</span>
<span id="cb2-66"><a href="#cb2-66" aria-hidden="true" tabindex="-1"></a>    gender_counts,</span>
<span id="cb2-67"><a href="#cb2-67" aria-hidden="true" tabindex="-1"></a>    labels<span class="op">=</span>gender_counts.index,</span>
<span id="cb2-68"><a href="#cb2-68" aria-hidden="true" tabindex="-1"></a>    autopct<span class="op">=</span><span class="st">'</span><span class="sc">%1.1f%%</span><span class="st">'</span>,</span>
<span id="cb2-69"><a href="#cb2-69" aria-hidden="true" tabindex="-1"></a>    colors<span class="op">=</span>[colors.get(combo, <span class="st">'gray'</span>) <span class="cf">for</span> combo <span class="kw">in</span> gender_counts.index],</span>
<span id="cb2-70"><a href="#cb2-70" aria-hidden="true" tabindex="-1"></a>    wedgeprops<span class="op">=</span>{<span class="st">'edgecolor'</span>: <span class="st">'w'</span>, <span class="st">'linewidth'</span>: <span class="dv">1</span>}</span>
<span id="cb2-71"><a href="#cb2-71" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-72"><a href="#cb2-72" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>, <span class="dv">0</span>].set_title(<span class="st">'Gender Distribution'</span>, fontfamily<span class="op">=</span><span class="st">'serif'</span>)</span>
<span id="cb2-73"><a href="#cb2-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-74"><a href="#cb2-74" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Summary table</span></span>
<span id="cb2-75"><a href="#cb2-75" aria-hidden="true" tabindex="-1"></a>summary_data <span class="op">=</span> [</span>
<span id="cb2-76"><a href="#cb2-76" aria-hidden="true" tabindex="-1"></a>    [<span class="st">"Total Sibling Pairs"</span>, <span class="ss">f"</span><span class="sc">{</span><span class="bu">len</span>(df)<span class="sc">}</span><span class="ss">"</span>],</span>
<span id="cb2-77"><a href="#cb2-77" aria-hidden="true" tabindex="-1"></a>    [<span class="st">"Average P1 Age"</span>, <span class="ss">f"</span><span class="sc">{</span>df[<span class="st">'P1agedays'</span>]<span class="sc">.</span>mean()<span class="op">/</span><span class="dv">30</span><span class="sc">:.1f}</span><span class="ss"> months"</span>],</span>
<span id="cb2-78"><a href="#cb2-78" aria-hidden="true" tabindex="-1"></a>    [<span class="st">"Average P2 Age"</span>, <span class="ss">f"</span><span class="sc">{</span>df[<span class="st">'P2agedays'</span>]<span class="sc">.</span>mean()<span class="op">/</span><span class="dv">30</span><span class="sc">:.1f}</span><span class="ss"> months"</span>],</span>
<span id="cb2-79"><a href="#cb2-79" aria-hidden="true" tabindex="-1"></a>    [<span class="st">"Average Age Difference"</span>, <span class="ss">f"</span><span class="sc">{</span>df[<span class="st">'AgeDifference'</span>]<span class="sc">.</span>mean()<span class="op">/</span><span class="dv">30</span><span class="sc">:.1f}</span><span class="ss"> months"</span>],</span>
<span id="cb2-80"><a href="#cb2-80" aria-hidden="true" tabindex="-1"></a>    [<span class="st">"Number of Males"</span>, <span class="ss">f"</span><span class="sc">{</span>(df[<span class="st">'GenderP1'</span>] <span class="op">==</span> <span class="st">'M'</span>)<span class="sc">.</span><span class="bu">sum</span>() <span class="op">+</span> (df[<span class="st">'GenderP2'</span>] <span class="op">==</span> <span class="st">'M'</span>)<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">}</span><span class="ss">"</span>],</span>
<span id="cb2-81"><a href="#cb2-81" aria-hidden="true" tabindex="-1"></a>    [<span class="st">"Number of Females"</span>, <span class="ss">f"</span><span class="sc">{</span>(df[<span class="st">'GenderP1'</span>] <span class="op">==</span> <span class="st">'F'</span>)<span class="sc">.</span><span class="bu">sum</span>() <span class="op">+</span> (df[<span class="st">'GenderP2'</span>] <span class="op">==</span> <span class="st">'F'</span>)<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">}</span><span class="ss">"</span>]</span>
<span id="cb2-82"><a href="#cb2-82" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb2-83"><a href="#cb2-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-84"><a href="#cb2-84" aria-hidden="true" tabindex="-1"></a><span class="co"># Turn off axis for table</span></span>
<span id="cb2-85"><a href="#cb2-85" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>, <span class="dv">1</span>].axis(<span class="st">'off'</span>)</span>
<span id="cb2-86"><a href="#cb2-86" aria-hidden="true" tabindex="-1"></a>table <span class="op">=</span> axs[<span class="dv">1</span>, <span class="dv">1</span>].table(</span>
<span id="cb2-87"><a href="#cb2-87" aria-hidden="true" tabindex="-1"></a>    cellText<span class="op">=</span>[row <span class="cf">for</span> row <span class="kw">in</span> summary_data],</span>
<span id="cb2-88"><a href="#cb2-88" aria-hidden="true" tabindex="-1"></a>    colLabels<span class="op">=</span>[<span class="st">"Measure"</span>, <span class="st">"Value"</span>],</span>
<span id="cb2-89"><a href="#cb2-89" aria-hidden="true" tabindex="-1"></a>    loc<span class="op">=</span><span class="st">'center'</span>,</span>
<span id="cb2-90"><a href="#cb2-90" aria-hidden="true" tabindex="-1"></a>    cellLoc<span class="op">=</span><span class="st">'left'</span></span>
<span id="cb2-91"><a href="#cb2-91" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-92"><a href="#cb2-92" aria-hidden="true" tabindex="-1"></a>table.auto_set_font_size(<span class="va">False</span>)</span>
<span id="cb2-93"><a href="#cb2-93" aria-hidden="true" tabindex="-1"></a>table.set_fontsize(<span class="dv">10</span>)</span>
<span id="cb2-94"><a href="#cb2-94" aria-hidden="true" tabindex="-1"></a>table.scale(<span class="dv">1</span>, <span class="fl">1.5</span>)</span>
<span id="cb2-95"><a href="#cb2-95" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>, <span class="dv">1</span>].set_title(<span class="st">'Dataset Summary'</span>, fontfamily<span class="op">=</span><span class="st">'serif'</span>)</span>
<span id="cb2-96"><a href="#cb2-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-97"><a href="#cb2-97" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb2-98"><a href="#cb2-98" aria-hidden="true" tabindex="-1"></a>plt.subplots_adjust(top<span class="op">=</span><span class="fl">0.9</span>)</span>
<span id="cb2-99"><a href="#cb2-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-100"><a href="#cb2-100" aria-hidden="true" tabindex="-1"></a><span class="co"># Save the figure to a file</span></span>
<span id="cb2-101"><a href="#cb2-101" aria-hidden="true" tabindex="-1"></a>output_path <span class="op">=</span> <span class="st">"images/sibling_analysis.png"</span></span>
<span id="cb2-102"><a href="#cb2-102" aria-hidden="true" tabindex="-1"></a>os.makedirs(os.path.dirname(output_path), exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb2-103"><a href="#cb2-103" aria-hidden="true" tabindex="-1"></a>plt.savefig(output_path, dpi<span class="op">=</span><span class="dv">300</span>, bbox_inches<span class="op">=</span><span class="st">'tight'</span>)</span>
<span id="cb2-104"><a href="#cb2-104" aria-hidden="true" tabindex="-1"></a>plt.close()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/sibling_analysis.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="600"></p>
</figure>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Setting up 🛠️
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">

</div>
</div>
</div>
</section>
</section>
<section id="motion-tracking-and-signal-processing-and-wrangling" class="level1">
<h1>Motion tracking and signal processing and wrangling</h1>
<p>The motion tracking and signal processing pipeline is divided into two main steps: 1. <strong>Tracking</strong>: This step involves tracking the movements of individuals in the videos using a pose estimation model. The output is a video with annotated keypoints and a CSV file containing the coordinates of these keypoints. 2. <strong>Signal Processing</strong>: This step involves processing the keypoint data to extract relevant features for analysis. The output are processed timeseries files, and a flat dataset containing our smoothness measures that are directly ready for statistical analysis.</p>
<section id="step-1-tracking-two-persons-in-videos-for-top-view-python" class="level2">
<h2 class="anchored" data-anchor-id="step-1-tracking-two-persons-in-videos-for-top-view-python">Step 1: Tracking two persons in videos for top-view (Python)</h2>
<p>We have tried several pose tracking solutions, such as OpenPose (model 25B; <span class="citation" data-cites="caoOpenPoseRealtimeMultiPerson2021">Cao et al. (<a href="#ref-caoOpenPoseRealtimeMultiPerson2021" role="doc-biblioref">2021</a>)</span>), Mediapipe (default highest complexity blazepose model; <span class="citation" data-cites="lugaresiMediaPipeFrameworkBuilding2019">Lugaresi et al. (<a href="#ref-lugaresiMediaPipeFrameworkBuilding2019" role="doc-biblioref">2019</a>)</span>) and we found that these models are not well equipped to track persons from top view, most likely because these models are not trained on ground-truth poses of persons from top-view camera angles. However, we found the heaviest model of yolo v8 (“yolov8x-pose-p6.pt”) does perform very well, especially as compared to the other models we tested. Thus, for this pipeline we recommend using YOLOv8 model for top-view tracking.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Installation Guide 🛠️
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<section id="step-0-github-repo" class="level3">
<h3 class="anchored" data-anchor-id="step-0-github-repo">Step 0: Github repo</h3>
<p>We assume you have cloned the repository <a href="https://github.com/WimPouw/InterPerDynPipeline">InterPerDynPipeline</a> and are in the root directory. The step 1 code for tracking is in the <code>./code_STEP1_posetrackingprocessing/</code> folder. In this folder you will find the Python script <code>yolo_tracking_processing.py</code>. To check whether you have the correct script you can compare against the code chunk provided below.</p>
</section>
<section id="step-1-install-requirements" class="level3">
<h3 class="anchored" data-anchor-id="step-1-install-requirements">Step 1: Install requirements</h3>
<p>For each script we have provided a <code>requirements.txt</code> file. You can install the requirements using pip, by first navigating to the folder where the script is located and then running the following command in your terminal:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> <span class="pp">[</span><span class="ss">yourspecificrootadress</span><span class="pp">]</span>/code_STEP1_posetrackingprocessing/</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="ex">pip</span> install <span class="at">-r</span> requirements.txt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="step-2-download-the-yolov8-model" class="level3">
<h3 class="anchored" data-anchor-id="step-2-download-the-yolov8-model">Step 2: Download the YOLOv8 model</h3>
<p>In the current GitHub repo we have a light-weight model <code>yolov8n-pose.pt</code> (~6.5MB) for immediate testing of the code. However, this model is not as accurate as the heaviest model.</p>
<p>We should download the heaviest model (<code>yolov8x-pose-p6.pt</code>) and save it to the <code>./code_STEP1_posetrackingprocessing/model/</code> directory:<br>
https://github.com/ultralytics/assets/releases/download/v8.1.0/yolov8x-pose-p6.pt</p>
<p><strong>Note</strong>: If you’re running the heavyweight model, you will need GPU support for this to run in a reasonable time. The lightweight model can run on CPU.</p>
</section>
<section id="step-3-run-the-python-script" class="level3">
<h3 class="anchored" data-anchor-id="step-3-run-the-python-script">Step 3: Run the python script</h3>
<p>Assuming you have videos in your data folder (<code>./data_raw/</code>) and you have a <code>.pt</code> model in the model folder, you can run the script using the following command:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> <span class="pp">[</span><span class="ss">yourspecificrootadress</span><span class="pp">]</span>/code_STEP1_posetrackingprocessing/</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="ex">python</span> yolo_tracking_processing.py</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</div>
</div>
</div>
<p>The code below is the script <code>yolo_tracking_processing.py</code> that you can run to track the videos. The output will be a video with annotated keypoints and a CSV file containing the coordinates of these keypoints. The script processes each video frame-by-frame, detecting people and their pose keypoints (17 points as listed in the script; see the <code>GetKeypoint class</code>). We filter out duplicate detections or skeletons with excessive missing data. Specifically, for each processed video, the script generates two output files: an annotated video showing the original footage with skeleton overlays (green points for accepted keypoints, red for filtered ones, and blue lines connecting the points), and a CSV file containing the raw coordinate data (frame number, person ID, keypoint ID, x-coordinate, y-coordinate). The output filenames include parameters like “c150” (150px proximity threshold) and “miss95” (95% missing data tolerance), which control how the system handles potential duplicate detections and incomplete skeletons. The user could adjust the parameter <code>close_threshold</code> and <code>miss_tolerance</code> to adjust the detection dynamics. We output the annotated video and the CSV file in the <code>./datatracked_afterSTEP1/</code> folder.</p>
<div class="cell" data-code_folding="hide">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> ultralytics <span class="im">import</span> YOLO</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pydantic <span class="im">import</span> BaseModel</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> cv2</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> csv</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> glob</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch <span class="co"># for gpu support</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> itertools <span class="im">import</span> combinations</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>torch.cuda.set_device(<span class="dv">0</span>)</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the model</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>modelfolder <span class="op">=</span> <span class="st">'./model/'</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>modellocation <span class="op">=</span> glob.glob(modelfolder<span class="op">+</span><span class="st">"*.pt"</span>)[<span class="dv">0</span>]</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>modelfile <span class="op">=</span> os.path.basename(modellocation)</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"We are loading in the following YOLO model: </span><span class="sc">{</span>modelfile<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> YOLO(modellocation)</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a><span class="co"># main variables</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>video_folder <span class="op">=</span> <span class="st">"../data_raw/"</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a><span class="co"># avi mp4 or other video formats</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>video_files <span class="op">=</span> glob.glob(video_folder <span class="op">+</span> <span class="st">"*.mp4"</span>) <span class="op">+</span> glob.glob(video_folder <span class="op">+</span> <span class="st">"*.avi"</span>) <span class="op">+</span> glob.glob(video_folder <span class="op">+</span> <span class="st">"*.mov"</span>) <span class="op">+</span> glob.glob(video_folder <span class="op">+</span> <span class="st">"*.mkv"</span>)</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>step1resultfolder <span class="op">=</span> <span class="st">"../datatracked_afterSTEP1/"</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(video_files)</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a><span class="co"># keypoint names</span></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> GetKeypoint(BaseModel):</span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>    NOSE:           <span class="bu">int</span> <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>    LEFT_EYE:       <span class="bu">int</span> <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>    RIGHT_EYE:      <span class="bu">int</span> <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>    LEFT_EAR:       <span class="bu">int</span> <span class="op">=</span> <span class="dv">3</span></span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>    RIGHT_EAR:      <span class="bu">int</span> <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>    LEFT_SHOULDER:  <span class="bu">int</span> <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>    RIGHT_SHOULDER: <span class="bu">int</span> <span class="op">=</span> <span class="dv">6</span></span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>    LEFT_ELBOW:     <span class="bu">int</span> <span class="op">=</span> <span class="dv">7</span></span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>    RIGHT_ELBOW:    <span class="bu">int</span> <span class="op">=</span> <span class="dv">8</span></span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>    LEFT_WRIST:     <span class="bu">int</span> <span class="op">=</span> <span class="dv">9</span></span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>    RIGHT_WRIST:    <span class="bu">int</span> <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>    LEFT_HIP:       <span class="bu">int</span> <span class="op">=</span> <span class="dv">11</span></span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>    RIGHT_HIP:      <span class="bu">int</span> <span class="op">=</span> <span class="dv">12</span></span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>    LEFT_KNEE:      <span class="bu">int</span> <span class="op">=</span> <span class="dv">13</span></span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>    RIGHT_KNEE:     <span class="bu">int</span> <span class="op">=</span> <span class="dv">14</span></span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a>    LEFT_ANKLE:     <span class="bu">int</span> <span class="op">=</span> <span class="dv">15</span></span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a>    RIGHT_ANKLE:    <span class="bu">int</span> <span class="op">=</span> <span class="dv">16</span></span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a>get_keypoint <span class="op">=</span> GetKeypoint()</span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a><span class="co"># Define skeleton connections</span></span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a>skeleton <span class="op">=</span> [</span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a>    (get_keypoint.LEFT_SHOULDER, get_keypoint.RIGHT_SHOULDER),</span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a>    (get_keypoint.LEFT_SHOULDER, get_keypoint.LEFT_ELBOW),</span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a>    (get_keypoint.RIGHT_SHOULDER, get_keypoint.RIGHT_ELBOW),</span>
<span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a>    (get_keypoint.LEFT_ELBOW, get_keypoint.LEFT_WRIST),</span>
<span id="cb5-54"><a href="#cb5-54" aria-hidden="true" tabindex="-1"></a>    (get_keypoint.RIGHT_ELBOW, get_keypoint.RIGHT_WRIST),</span>
<span id="cb5-55"><a href="#cb5-55" aria-hidden="true" tabindex="-1"></a>    (get_keypoint.LEFT_SHOULDER, get_keypoint.LEFT_HIP),</span>
<span id="cb5-56"><a href="#cb5-56" aria-hidden="true" tabindex="-1"></a>    (get_keypoint.RIGHT_SHOULDER, get_keypoint.RIGHT_HIP),</span>
<span id="cb5-57"><a href="#cb5-57" aria-hidden="true" tabindex="-1"></a>    (get_keypoint.LEFT_HIP, get_keypoint.RIGHT_HIP),</span>
<span id="cb5-58"><a href="#cb5-58" aria-hidden="true" tabindex="-1"></a>    (get_keypoint.LEFT_HIP, get_keypoint.LEFT_KNEE),</span>
<span id="cb5-59"><a href="#cb5-59" aria-hidden="true" tabindex="-1"></a>    (get_keypoint.RIGHT_HIP, get_keypoint.RIGHT_KNEE),</span>
<span id="cb5-60"><a href="#cb5-60" aria-hidden="true" tabindex="-1"></a>    (get_keypoint.LEFT_KNEE, get_keypoint.LEFT_ANKLE),</span>
<span id="cb5-61"><a href="#cb5-61" aria-hidden="true" tabindex="-1"></a>    (get_keypoint.RIGHT_KNEE, get_keypoint.RIGHT_ANKLE),</span>
<span id="cb5-62"><a href="#cb5-62" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb5-63"><a href="#cb5-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-64"><a href="#cb5-64" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> tensor_to_matrix(results_tensor):</span>
<span id="cb5-65"><a href="#cb5-65" aria-hidden="true" tabindex="-1"></a>    <span class="co"># this just takes the results output of YOLO and coverts it to a matrix,</span></span>
<span id="cb5-66"><a href="#cb5-66" aria-hidden="true" tabindex="-1"></a>    <span class="co"># making it easier to do quick calculations on the coordinates</span></span>
<span id="cb5-67"><a href="#cb5-67" aria-hidden="true" tabindex="-1"></a>    results_list <span class="op">=</span> results_tensor.tolist()</span>
<span id="cb5-68"><a href="#cb5-68" aria-hidden="true" tabindex="-1"></a>    results_matrix <span class="op">=</span> np.matrix(results_list)</span>
<span id="cb5-69"><a href="#cb5-69" aria-hidden="true" tabindex="-1"></a>    results_matrix[results_matrix<span class="op">==</span><span class="dv">0</span>] <span class="op">=</span> np.nan</span>
<span id="cb5-70"><a href="#cb5-70" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> results_matrix</span>
<span id="cb5-71"><a href="#cb5-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-72"><a href="#cb5-72" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> check_for_duplication(results):</span>
<span id="cb5-73"><a href="#cb5-73" aria-hidden="true" tabindex="-1"></a>    <span class="co"># this threshold determines how close two skeletons must be in order to be</span></span>
<span id="cb5-74"><a href="#cb5-74" aria-hidden="true" tabindex="-1"></a>    <span class="co"># considered the same person. Arbitrarily chosen for now.</span></span>
<span id="cb5-75"><a href="#cb5-75" aria-hidden="true" tabindex="-1"></a>    close_threshold <span class="op">=</span><span class="dv">150</span></span>
<span id="cb5-76"><a href="#cb5-76" aria-hidden="true" tabindex="-1"></a>    <span class="co"># missing data tolerance</span></span>
<span id="cb5-77"><a href="#cb5-77" aria-hidden="true" tabindex="-1"></a>    miss_tolerance <span class="op">=</span> <span class="fl">0.95</span> <span class="co"># this means we can miss up to 75% of the keypoints</span></span>
<span id="cb5-78"><a href="#cb5-78" aria-hidden="true" tabindex="-1"></a>    drop_indices <span class="op">=</span> []</span>
<span id="cb5-79"><a href="#cb5-79" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(results[<span class="dv">0</span>].keypoints.xy) <span class="op">&gt;</span> <span class="dv">1</span>:</span>
<span id="cb5-80"><a href="#cb5-80" aria-hidden="true" tabindex="-1"></a>        conf_scores <span class="op">=</span> []</span>
<span id="cb5-81"><a href="#cb5-81" aria-hidden="true" tabindex="-1"></a>        <span class="co"># get detection confidence for each skeleton</span></span>
<span id="cb5-82"><a href="#cb5-82" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> person <span class="kw">in</span> tensor_to_matrix(results[<span class="dv">0</span>].keypoints.conf):</span>
<span id="cb5-83"><a href="#cb5-83" aria-hidden="true" tabindex="-1"></a>            conf_scores.append(np.mean(person))</span>
<span id="cb5-84"><a href="#cb5-84" aria-hidden="true" tabindex="-1"></a>           </span>
<span id="cb5-85"><a href="#cb5-85" aria-hidden="true" tabindex="-1"></a>        <span class="co"># this list will stores which comparisons need to be made</span></span>
<span id="cb5-86"><a href="#cb5-86" aria-hidden="true" tabindex="-1"></a>        combos <span class="op">=</span> <span class="bu">list</span>(combinations(<span class="bu">range</span>(<span class="bu">len</span>(results[<span class="dv">0</span>].keypoints.xy)), <span class="dv">2</span>))</span>
<span id="cb5-87"><a href="#cb5-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-88"><a href="#cb5-88" aria-hidden="true" tabindex="-1"></a>        <span class="co"># now loop through these comparisons</span></span>
<span id="cb5-89"><a href="#cb5-89" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> combo <span class="kw">in</span> combos:</span>
<span id="cb5-90"><a href="#cb5-90" aria-hidden="true" tabindex="-1"></a>            closeness <span class="op">=</span> <span class="bu">abs</span>(np.nanmean(tensor_to_matrix(results[<span class="dv">0</span>].keypoints.xy[combo[<span class="dv">0</span>]]) <span class="op">-</span> </span>
<span id="cb5-91"><a href="#cb5-91" aria-hidden="true" tabindex="-1"></a>                        tensor_to_matrix(results[<span class="dv">0</span>].keypoints.xy[combo[<span class="dv">1</span>]])))</span>
<span id="cb5-92"><a href="#cb5-92" aria-hidden="true" tabindex="-1"></a>            <span class="co"># if any of them indicate that two skeletons are very close together,</span></span>
<span id="cb5-93"><a href="#cb5-93" aria-hidden="true" tabindex="-1"></a>            <span class="co"># we keep the one with higher tracking confidence, and remove the other</span></span>
<span id="cb5-94"><a href="#cb5-94" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> closeness <span class="op">&lt;</span> close_threshold:</span>
<span id="cb5-95"><a href="#cb5-95" aria-hidden="true" tabindex="-1"></a>                conf_list <span class="op">=</span> [conf_scores[combo[<span class="dv">0</span>]], conf_scores[combo[<span class="dv">1</span>]]]</span>
<span id="cb5-96"><a href="#cb5-96" aria-hidden="true" tabindex="-1"></a>                idx_min <span class="op">=</span> conf_list.index(<span class="bu">min</span>(conf_list))</span>
<span id="cb5-97"><a href="#cb5-97" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb5-98"><a href="#cb5-98" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb5-99"><a href="#cb5-99" aria-hidden="true" tabindex="-1"></a>                drop_indices.append(combo[idx_min])</span>
<span id="cb5-100"><a href="#cb5-100" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb5-101"><a href="#cb5-101" aria-hidden="true" tabindex="-1"></a>        <span class="co"># additional checks:</span></span>
<span id="cb5-102"><a href="#cb5-102" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> person <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(results[<span class="dv">0</span>].keypoints.xy)):</span>
<span id="cb5-103"><a href="#cb5-103" aria-hidden="true" tabindex="-1"></a>           keypoints_missed <span class="op">=</span>  np.isnan(tensor_to_matrix(results[<span class="dv">0</span>].keypoints.xy[person])).<span class="bu">sum</span>()<span class="op">/</span><span class="dv">2</span></span>
<span id="cb5-104"><a href="#cb5-104" aria-hidden="true" tabindex="-1"></a>           perc_missed <span class="op">=</span> keypoints_missed<span class="op">/</span><span class="bu">len</span>(tensor_to_matrix(results[<span class="dv">0</span>].keypoints.xy[person]))</span>
<span id="cb5-105"><a href="#cb5-105" aria-hidden="true" tabindex="-1"></a>           </span>
<span id="cb5-106"><a href="#cb5-106" aria-hidden="true" tabindex="-1"></a>           <span class="cf">if</span> perc_missed <span class="op">&gt;</span> miss_tolerance:</span>
<span id="cb5-107"><a href="#cb5-107" aria-hidden="true" tabindex="-1"></a>               drop_indices.append(person)</span>
<span id="cb5-108"><a href="#cb5-108" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb5-109"><a href="#cb5-109" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">list</span>(<span class="bu">set</span>(drop_indices))</span>
<span id="cb5-110"><a href="#cb5-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-111"><a href="#cb5-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-112"><a href="#cb5-112" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> video_path <span class="kw">in</span> video_files:</span>
<span id="cb5-113"><a href="#cb5-113" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Video path</span></span>
<span id="cb5-114"><a href="#cb5-114" aria-hidden="true" tabindex="-1"></a>    video_path <span class="op">=</span> video_path</span>
<span id="cb5-115"><a href="#cb5-115" aria-hidden="true" tabindex="-1"></a>    <span class="co"># only if the output is not there yet</span></span>
<span id="cb5-116"><a href="#cb5-116" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> os.path.exists(step1resultfolder<span class="op">+</span> os.path.basename(video_path).split(<span class="st">'.'</span>)[<span class="dv">0</span>]<span class="op">+</span><span class="st">"_annotated_layer1_c150_miss95.mp4"</span>):</span>
<span id="cb5-117"><a href="#cb5-117" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Output video already exists for </span><span class="sc">{</span>video_path<span class="sc">}</span><span class="ss">. Skipping..."</span>)</span>
<span id="cb5-118"><a href="#cb5-118" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb5-119"><a href="#cb5-119" aria-hidden="true" tabindex="-1"></a>    <span class="co"># vidname without extension</span></span>
<span id="cb5-120"><a href="#cb5-120" aria-hidden="true" tabindex="-1"></a>    vidname <span class="op">=</span> os.path.basename(video_path)</span>
<span id="cb5-121"><a href="#cb5-121" aria-hidden="true" tabindex="-1"></a>    vidname <span class="op">=</span> vidname.split(<span class="st">'.'</span>)[<span class="dv">0</span>]</span>
<span id="cb5-122"><a href="#cb5-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-123"><a href="#cb5-123" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Open the video</span></span>
<span id="cb5-124"><a href="#cb5-124" aria-hidden="true" tabindex="-1"></a>    cap <span class="op">=</span> cv2.VideoCapture(video_path)</span>
<span id="cb5-125"><a href="#cb5-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-126"><a href="#cb5-126" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get video properties</span></span>
<span id="cb5-127"><a href="#cb5-127" aria-hidden="true" tabindex="-1"></a>    fps <span class="op">=</span> <span class="bu">int</span>(cap.get(cv2.CAP_PROP_FPS))</span>
<span id="cb5-128"><a href="#cb5-128" aria-hidden="true" tabindex="-1"></a>    width <span class="op">=</span> <span class="bu">int</span>(cap.get(cv2.CAP_PROP_FRAME_WIDTH))</span>
<span id="cb5-129"><a href="#cb5-129" aria-hidden="true" tabindex="-1"></a>    height <span class="op">=</span> <span class="bu">int</span>(cap.get(cv2.CAP_PROP_FRAME_HEIGHT))</span>
<span id="cb5-130"><a href="#cb5-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-131"><a href="#cb5-131" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Define the output video writer</span></span>
<span id="cb5-132"><a href="#cb5-132" aria-hidden="true" tabindex="-1"></a>    corename <span class="op">=</span> os.path.basename(video_path).split(<span class="st">'.'</span>)[<span class="dv">0</span>]</span>
<span id="cb5-133"><a href="#cb5-133" aria-hidden="true" tabindex="-1"></a>    output_path <span class="op">=</span> step1resultfolder<span class="op">+</span> vidname<span class="op">+</span><span class="st">"_annotated_layer1_c150_miss95.mp4"</span></span>
<span id="cb5-134"><a href="#cb5-134" aria-hidden="true" tabindex="-1"></a>    fourcc <span class="op">=</span> cv2.VideoWriter_fourcc(<span class="op">*</span><span class="st">'mp4v'</span>)</span>
<span id="cb5-135"><a href="#cb5-135" aria-hidden="true" tabindex="-1"></a>    out <span class="op">=</span> cv2.VideoWriter(output_path, fourcc, fps, (width, height))</span>
<span id="cb5-136"><a href="#cb5-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-137"><a href="#cb5-137" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Prepare CSV file</span></span>
<span id="cb5-138"><a href="#cb5-138" aria-hidden="true" tabindex="-1"></a>    csv_path <span class="op">=</span> step1resultfolder<span class="op">+</span> vidname<span class="op">+</span><span class="st">'_keypoints_data_layer1.csv'</span></span>
<span id="cb5-139"><a href="#cb5-139" aria-hidden="true" tabindex="-1"></a>    csv_file <span class="op">=</span> <span class="bu">open</span>(csv_path, <span class="st">'w'</span>, newline<span class="op">=</span><span class="st">''</span>)</span>
<span id="cb5-140"><a href="#cb5-140" aria-hidden="true" tabindex="-1"></a>    csv_writer <span class="op">=</span> csv.writer(csv_file)</span>
<span id="cb5-141"><a href="#cb5-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-142"><a href="#cb5-142" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Write header</span></span>
<span id="cb5-143"><a href="#cb5-143" aria-hidden="true" tabindex="-1"></a>    header <span class="op">=</span> [<span class="st">'frame'</span>, <span class="st">'person'</span>, <span class="st">'keypoint'</span>, <span class="st">'x'</span>, <span class="st">'y'</span>]</span>
<span id="cb5-144"><a href="#cb5-144" aria-hidden="true" tabindex="-1"></a>    csv_writer.writerow(header)</span>
<span id="cb5-145"><a href="#cb5-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-146"><a href="#cb5-146" aria-hidden="true" tabindex="-1"></a>    frame_count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb5-147"><a href="#cb5-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-148"><a href="#cb5-148" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> cap.isOpened():</span>
<span id="cb5-149"><a href="#cb5-149" aria-hidden="true" tabindex="-1"></a>        success, frame <span class="op">=</span> cap.read()</span>
<span id="cb5-150"><a href="#cb5-150" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> success:</span>
<span id="cb5-151"><a href="#cb5-151" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb5-152"><a href="#cb5-152" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-153"><a href="#cb5-153" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Run YOLOv8 inference on the frame</span></span>
<span id="cb5-154"><a href="#cb5-154" aria-hidden="true" tabindex="-1"></a>        results <span class="op">=</span> model(frame)</span>
<span id="cb5-155"><a href="#cb5-155" aria-hidden="true" tabindex="-1"></a>               </span>
<span id="cb5-156"><a href="#cb5-156" aria-hidden="true" tabindex="-1"></a>        <span class="co"># write empty rows if no person is detected</span></span>
<span id="cb5-157"><a href="#cb5-157" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(results[<span class="dv">0</span>].keypoints.xy) <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb5-158"><a href="#cb5-158" aria-hidden="true" tabindex="-1"></a>            csv_writer.writerow([frame_count, <span class="va">None</span>, <span class="va">None</span>, <span class="va">None</span>, <span class="va">None</span>])</span>
<span id="cb5-159"><a href="#cb5-159" aria-hidden="true" tabindex="-1"></a>        annotated_frame <span class="op">=</span> frame</span>
<span id="cb5-160"><a href="#cb5-160" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb5-161"><a href="#cb5-161" aria-hidden="true" tabindex="-1"></a>        <span class="co"># only do this if a person is detected</span></span>
<span id="cb5-162"><a href="#cb5-162" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(results[<span class="dv">0</span>].keypoints.xy) <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb5-163"><a href="#cb5-163" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Process the results</span></span>
<span id="cb5-164"><a href="#cb5-164" aria-hidden="true" tabindex="-1"></a>            drop_indices <span class="op">=</span> []</span>
<span id="cb5-165"><a href="#cb5-165" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb5-166"><a href="#cb5-166" aria-hidden="true" tabindex="-1"></a>            drop_indices <span class="op">=</span> check_for_duplication(results)</span>
<span id="cb5-167"><a href="#cb5-167" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb5-168"><a href="#cb5-168" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb5-169"><a href="#cb5-169" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> person_idx, person_keypoints <span class="kw">in</span> <span class="bu">enumerate</span>(results[<span class="dv">0</span>].keypoints.xy):</span>
<span id="cb5-170"><a href="#cb5-170" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> person_idx <span class="kw">not</span> <span class="kw">in</span> drop_indices:</span>
<span id="cb5-171"><a href="#cb5-171" aria-hidden="true" tabindex="-1"></a>                    colourcode <span class="op">=</span> (<span class="dv">0</span>, <span class="dv">255</span>, <span class="dv">0</span>)</span>
<span id="cb5-172"><a href="#cb5-172" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb5-173"><a href="#cb5-173" aria-hidden="true" tabindex="-1"></a>                    colourcode <span class="op">=</span> (<span class="dv">255</span>, <span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb5-174"><a href="#cb5-174" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb5-175"><a href="#cb5-175" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> keypoint_idx, keypoint <span class="kw">in</span> <span class="bu">enumerate</span>(person_keypoints):</span>
<span id="cb5-176"><a href="#cb5-176" aria-hidden="true" tabindex="-1"></a>                    x, y <span class="op">=</span> keypoint</span>
<span id="cb5-177"><a href="#cb5-177" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb5-178"><a href="#cb5-178" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># Write to CSV</span></span>
<span id="cb5-179"><a href="#cb5-179" aria-hidden="true" tabindex="-1"></a>                    csv_writer.writerow([frame_count, person_idx, keypoint_idx, x.item(), y.item()])</span>
<span id="cb5-180"><a href="#cb5-180" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb5-181"><a href="#cb5-181" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># Draw keypoint on the frame</span></span>
<span id="cb5-182"><a href="#cb5-182" aria-hidden="true" tabindex="-1"></a>                    cv2.circle(annotated_frame, (<span class="bu">int</span>(x), <span class="bu">int</span>(y)), <span class="dv">5</span>, colourcode, <span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb5-183"><a href="#cb5-183" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb5-184"><a href="#cb5-184" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Draw skeleton</span></span>
<span id="cb5-185"><a href="#cb5-185" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> connection <span class="kw">in</span> skeleton:</span>
<span id="cb5-186"><a href="#cb5-186" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> connection[<span class="dv">0</span>] <span class="op">&lt;</span> <span class="bu">len</span>(person_keypoints) <span class="kw">and</span> connection[<span class="dv">1</span>] <span class="op">&lt;</span> <span class="bu">len</span>(person_keypoints):</span>
<span id="cb5-187"><a href="#cb5-187" aria-hidden="true" tabindex="-1"></a>                        start_point <span class="op">=</span> <span class="bu">tuple</span>(<span class="bu">map</span>(<span class="bu">int</span>, person_keypoints[connection[<span class="dv">0</span>]]))</span>
<span id="cb5-188"><a href="#cb5-188" aria-hidden="true" tabindex="-1"></a>                        end_point <span class="op">=</span> <span class="bu">tuple</span>(<span class="bu">map</span>(<span class="bu">int</span>, person_keypoints[connection[<span class="dv">1</span>]]))</span>
<span id="cb5-189"><a href="#cb5-189" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> <span class="bu">all</span>(start_point) <span class="kw">and</span> <span class="bu">all</span>(end_point):  <span class="co"># Check if both points are valid</span></span>
<span id="cb5-190"><a href="#cb5-190" aria-hidden="true" tabindex="-1"></a>                            cv2.line(annotated_frame, start_point, end_point, (<span class="dv">255</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="dv">2</span>)</span>
<span id="cb5-191"><a href="#cb5-191" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb5-192"><a href="#cb5-192" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Write the frame to the output video</span></span>
<span id="cb5-193"><a href="#cb5-193" aria-hidden="true" tabindex="-1"></a>            out.write(annotated_frame)</span>
<span id="cb5-194"><a href="#cb5-194" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb5-195"><a href="#cb5-195" aria-hidden="true" tabindex="-1"></a>        frame_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb5-196"><a href="#cb5-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-197"><a href="#cb5-197" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Release everything</span></span>
<span id="cb5-198"><a href="#cb5-198" aria-hidden="true" tabindex="-1"></a>    cap.release()</span>
<span id="cb5-199"><a href="#cb5-199" aria-hidden="true" tabindex="-1"></a>    out.release()</span>
<span id="cb5-200"><a href="#cb5-200" aria-hidden="true" tabindex="-1"></a>    cv2.destroyAllWindows()</span>
<span id="cb5-201"><a href="#cb5-201" aria-hidden="true" tabindex="-1"></a>    csv_file.close()</span>
<span id="cb5-202"><a href="#cb5-202" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Output video saved as </span><span class="sc">{</span>output_path<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb5-203"><a href="#cb5-203" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Keypoints data saved as </span><span class="sc">{</span>csv_path<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Here is an example of the output video with annotated keypoints and skeletons. The green points indicate accepted keypoints, while the red points indicate filtered ones. The blue lines connect the keypoints to form a skeleton.</p>

<video width="300" height="200" controls="">
<source src="./images/videosrerendered/sample.mp4" type="video/mp4">
Your browser does not support the video tag. </video>

<p>Here is an example of the output csv file containing the coordinates of the keypoints. The CSV file contains the following columns: frame number, person ID, keypoint ID, x-coordinate, and y-coordinate. Each row corresponds to a detected keypoint in a specific frame.</p>
<div class="cell" data-code_folding="hide">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> glob <span class="im">as</span> glob</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>folderstep1output <span class="op">=</span> <span class="st">"./datatracked_afterSTEP1/"</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the CSV file</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>csv_file <span class="op">=</span> glob.glob(folderstep1output <span class="op">+</span> <span class="st">"*.csv"</span>)[<span class="dv">0</span>]</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(csv_file)</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the first few rows of the DataFrame</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.head())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   frame  person  keypoint            x           y
0      0       0         0     0.000000    0.000000
1      0       0         1     0.000000    0.000000
2      0       0         2     0.000000    0.000000
3      0       0         3     0.000000    0.000000
4      0       0         4  1625.318604  828.275513</code></pre>
</div>
</div>
</section>
<section id="step-2-timeseries-preparation-and-flat-data-for-statistics" class="level2">
<h2 class="anchored" data-anchor-id="step-2-timeseries-preparation-and-flat-data-for-statistics">Step 2: Timeseries preparation and flat data for statistics</h2>
</section>
</section>
<section id="statistical-analysis-on-smoothness-derived-from-timeseries-analysis-r" class="level1">
<h1>Statistical analysis on smoothness derived from timeseries analysis (R)</h1>
<div class="cell" data-code_folding="hide">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># manually edited this CSV</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"C:/Users/wiltshir/GitHub/InterPerDynPipelineAnalysis/Re_ Behavioral Dynamics in Social Interactions AP_SI/smoothness_data_top_view_clean.csv"</span>) </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co">#data_cross_cultur&lt;-data[1:18,]</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove a row</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>data<span class="ot">&lt;-</span> <span class="fu">subset</span>(data, data<span class="sc">$</span>videoID<span class="sc">!=</span><span class="st">"cop_b09 z góry"</span>)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a culture grouping variable</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>culture <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">grepl</span>(<span class="st">"góry$"</span>, data<span class="sc">$</span>videoID), <span class="st">"Yurakare"</span>,</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">ifelse</span>(<span class="fu">grepl</span>(<span class="st">"kam_5$"</span>, data<span class="sc">$</span>videoID), <span class="st">"Polish"</span>, <span class="cn">NA</span>))</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Restructure data into long format</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>data_long <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(smoothness_p1_proximity, smoothness_p2_proximity),</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"person"</span>,</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"smoothness_value"</span>)</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lme4) </span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lmerTest) </span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>model1 <span class="ot">&lt;-</span> <span class="fu">lmer</span>(smoothness_value <span class="sc">~</span> culture <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> videoID), <span class="at">data =</span> data_long)</span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="statistical-analysis-on-measures-derived-from-non-linear-time-series-analysis" class="level1">
<h1>Statistical analysis on measures derived from non-linear time series analysis</h1>
</section>
<section id="references" class="level1">

<!-- -->


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-caoOpenPoseRealtimeMultiPerson2021" class="csl-entry" role="listitem">
Cao, Zhe, Gines Hidalgo, Tomas Simon, Shih-En Wei, and Yaser Sheikh. 2021. <span>“<span>OpenPose</span>: <span>Realtime Multi-Person 2D Pose Estimation Using Part Affinity Fields</span>.”</span> <em>IEEE Transactions on Pattern Analysis and Machine Intelligence</em> 43 (1): 172–86. <a href="https://doi.org/10.1109/TPAMI.2019.2929257">https://doi.org/10.1109/TPAMI.2019.2929257</a>.
</div>
<div id="ref-lugaresiMediaPipeFrameworkBuilding2019" class="csl-entry" role="listitem">
Lugaresi, Camillo, Jiuqiang Tang, Hadon Nash, Chris McClanahan, Esha Uboweja, Michael Hays, Fan Zhang, et al. 2019. <span>“<span>MediaPipe</span>: <span>A Framework</span> for <span>Building Perception Pipelines</span>.”</span> arXiv. <a href="https://doi.org/10.48550/arXiv.1906.08172">https://doi.org/10.48550/arXiv.1906.08172</a>.
</div>
<div id="ref-owoyeleMaskAnyoneToolkitOffering2024" class="csl-entry" role="listitem">
Owoyele, Babajide Alamu, Martin Schilling, Rohan Sawahn, Niklas Kaemer, Pavel Zherebenkov, Bhuvanesh Verma, Wim Pouw, and Gerard de Melo. 2024. <span>“<span>MaskAnyone Toolkit</span>: <span>Offering Strategies</span> for <span>Minimizing Privacy Risks</span> and <span>Maximizing Utility</span> in <span>Audio-Visual Data Archiving</span>.”</span> arXiv. <a href="https://doi.org/10.48550/arXiv.2408.03185">https://doi.org/10.48550/arXiv.2408.03185</a>.
</div>
</div></section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb9" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "An Open-source Standardized Pipeline for Tracing the Behavioral Dynamics in Social Interactions"</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="an">subtitle:</span><span class="co"> "Computationally Reproducible Extended Methods Section"</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> "`r format(Sys.time(), '%B %d, %Y')`"</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> </span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="co">  - name: Arkadiusz Białek</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="co">    affiliation: Jagiellonian University, Poland</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="co">  - name: Wim Pouw</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="co">    affiliation: Tilburg University, Netherlands</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="co">  - name: Travis J. Wiltshire</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="co">    affiliation: Tilburg University, Netherlands</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="co">  - name: James Trujillo</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="co">    affiliation: University of Amsterdam, USA</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="co">  - name: Fred Hasselman</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="co">    affiliation: Radboud University, Netherlands</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a><span class="co">  - name: Babajide Alamu Owoyele</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a><span class="co">    affiliation: Hasso Plattner Institute, University of Potsdam, Germany</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a><span class="co">  - name: Natalia Siekiera</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a><span class="co">    affiliation: Jagiellonian University, Poland</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a><span class="co">  - name: Joanna Rączaszek-Leonardi</span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a><span class="co">    affiliation: University of Warsaw, Poland</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a><span class="an">contact:</span><span class="co"> </span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a><span class="co">  - name: Wim Pouw</span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a><span class="co">    email: w.pouw@tilburguniversity.edu</span></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a><span class="an">bibliography:</span><span class="co"> quarto_dependencies/references/refs.bib</span></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a><span class="an">theme:</span><span class="co"> journal</span></span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a><span class="an">css:</span><span class="co"> quarto_dependencies/styles/styles.css</span></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: true</span></span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true  # Adds a code button to toggle all code</span></span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a><span class="al">![](images/ts.gif)</span></span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a><span class="fu"># Overview</span></span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>To increase privacy we apply maskanyone <span class="co">[</span><span class="ot">@owoyeleMaskAnyoneToolkitOffering2024</span><span class="co">]</span>.</span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a><span class="fu"># Dataset</span></span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a>The following data has been made available in masked form.</span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a>::: {.callout-note .callout-download collapse="true"}</span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a><span class="fu">## Download Guide ⬇️</span></span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a>The masked data can be downloaded from the repository of Jagellonian University <span class="co">[</span><span class="ot">here</span><span class="co">]()</span>. The unmasked data can be requested from the authors. The unmasked data is not available in this repository for privacy reasons.</span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a><span class="fu">### Dataset Mother Infant</span></span>
<span id="cb9-49"><a href="#cb9-49" aria-hidden="true" tabindex="-1"></a><span class="in">```{python, eval=FALSE, code_folding="hide"}</span></span>
<span id="cb9-50"><a href="#cb9-50" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib</span>
<span id="cb9-51"><a href="#cb9-51" aria-hidden="true" tabindex="-1"></a>matplotlib.use(<span class="st">'agg'</span>)</span>
<span id="cb9-52"><a href="#cb9-52" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb9-53"><a href="#cb9-53" aria-hidden="true" tabindex="-1"></a>plt.ioff()</span>
<span id="cb9-54"><a href="#cb9-54" aria-hidden="true" tabindex="-1"></a>plt.clf() <span class="co"># Clear any existing figures</span></span>
<span id="cb9-55"><a href="#cb9-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-56"><a href="#cb9-56" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb9-57"><a href="#cb9-57" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb9-58"><a href="#cb9-58" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb9-59"><a href="#cb9-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-60"><a href="#cb9-60" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the data</span></span>
<span id="cb9-61"><a href="#cb9-61" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">'./meta/project_point_metadata_ages.csv'</span>)</span>
<span id="cb9-62"><a href="#cb9-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-63"><a href="#cb9-63" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert gender to categorical label</span></span>
<span id="cb9-64"><a href="#cb9-64" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'gender_label'</span>] <span class="op">=</span> df[<span class="st">'gender'</span>].<span class="bu">map</span>({<span class="dv">0</span>: <span class="st">'Female'</span>, <span class="dv">1</span>: <span class="st">'Male'</span>})</span>
<span id="cb9-65"><a href="#cb9-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-66"><a href="#cb9-66" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a 2x2 subplot layout</span></span>
<span id="cb9-67"><a href="#cb9-67" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">10</span>), gridspec_kw<span class="op">=</span>{<span class="st">'width_ratios'</span>: [<span class="fl">1.5</span>, <span class="dv">1</span>], <span class="st">'height_ratios'</span>: [<span class="fl">1.5</span>, <span class="dv">1</span>]})</span>
<span id="cb9-68"><a href="#cb9-68" aria-hidden="true" tabindex="-1"></a>fig.suptitle(<span class="st">'Mother-Infant Dataset Overview'</span>, fontsize<span class="op">=</span><span class="dv">16</span>, fontfamily<span class="op">=</span><span class="st">'serif'</span>)</span>
<span id="cb9-69"><a href="#cb9-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-70"><a href="#cb9-70" aria-hidden="true" tabindex="-1"></a><span class="co"># Define colors for gender</span></span>
<span id="cb9-71"><a href="#cb9-71" aria-hidden="true" tabindex="-1"></a>colors <span class="op">=</span> {</span>
<span id="cb9-72"><a href="#cb9-72" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Female'</span>: <span class="st">'#C55A11'</span>,   <span class="co"># Orange for females</span></span>
<span id="cb9-73"><a href="#cb9-73" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Male'</span>: <span class="st">'#4472C4'</span>       <span class="co"># Blue for males</span></span>
<span id="cb9-74"><a href="#cb9-74" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb9-75"><a href="#cb9-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-76"><a href="#cb9-76" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Line plot - Age progression across time points</span></span>
<span id="cb9-77"><a href="#cb9-77" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx, row <span class="kw">in</span> df.iterrows():</span>
<span id="cb9-78"><a href="#cb9-78" aria-hidden="true" tabindex="-1"></a>    gender <span class="op">=</span> row[<span class="st">'gender_label'</span>]</span>
<span id="cb9-79"><a href="#cb9-79" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create arrays for days and time points, handling NaN values</span></span>
<span id="cb9-80"><a href="#cb9-80" aria-hidden="true" tabindex="-1"></a>    days <span class="op">=</span> []</span>
<span id="cb9-81"><a href="#cb9-81" aria-hidden="true" tabindex="-1"></a>    timepoints <span class="op">=</span> []</span>
<span id="cb9-82"><a href="#cb9-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-83"><a href="#cb9-83" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">8</span>):   <span class="co"># T1 to T7</span></span>
<span id="cb9-84"><a href="#cb9-84" aria-hidden="true" tabindex="-1"></a>        day_col <span class="op">=</span> <span class="ss">f'age_T</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">_days'</span></span>
<span id="cb9-85"><a href="#cb9-85" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> day_col <span class="kw">in</span> df.columns <span class="kw">and</span> pd.notna(row[day_col]) <span class="kw">and</span> row[day_col] <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb9-86"><a href="#cb9-86" aria-hidden="true" tabindex="-1"></a>            days.append(row[day_col])</span>
<span id="cb9-87"><a href="#cb9-87" aria-hidden="true" tabindex="-1"></a>            timepoints.append(i)</span>
<span id="cb9-88"><a href="#cb9-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-89"><a href="#cb9-89" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Plot the line for this infant</span></span>
<span id="cb9-90"><a href="#cb9-90" aria-hidden="true" tabindex="-1"></a>    axs[<span class="dv">0</span>, <span class="dv">0</span>].plot(</span>
<span id="cb9-91"><a href="#cb9-91" aria-hidden="true" tabindex="-1"></a>        timepoints,</span>
<span id="cb9-92"><a href="#cb9-92" aria-hidden="true" tabindex="-1"></a>        days,</span>
<span id="cb9-93"><a href="#cb9-93" aria-hidden="true" tabindex="-1"></a>        marker<span class="op">=</span><span class="st">'o'</span>,</span>
<span id="cb9-94"><a href="#cb9-94" aria-hidden="true" tabindex="-1"></a>        color<span class="op">=</span>colors[gender],</span>
<span id="cb9-95"><a href="#cb9-95" aria-hidden="true" tabindex="-1"></a>        alpha<span class="op">=</span><span class="fl">0.5</span>,</span>
<span id="cb9-96"><a href="#cb9-96" aria-hidden="true" tabindex="-1"></a>        linewidth<span class="op">=</span><span class="fl">1.5</span></span>
<span id="cb9-97"><a href="#cb9-97" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb9-98"><a href="#cb9-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-99"><a href="#cb9-99" aria-hidden="true" tabindex="-1"></a><span class="co"># Customize the plot</span></span>
<span id="cb9-100"><a href="#cb9-100" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>, <span class="dv">0</span>].set_xlabel(<span class="st">'Time Point'</span>, fontfamily<span class="op">=</span><span class="st">'serif'</span>)</span>
<span id="cb9-101"><a href="#cb9-101" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>, <span class="dv">0</span>].set_ylabel(<span class="st">'Age (days)'</span>, fontfamily<span class="op">=</span><span class="st">'serif'</span>)</span>
<span id="cb9-102"><a href="#cb9-102" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>, <span class="dv">0</span>].set_title(<span class="st">'Infant Age Progression'</span>, fontfamily<span class="op">=</span><span class="st">'serif'</span>)</span>
<span id="cb9-103"><a href="#cb9-103" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>, <span class="dv">0</span>].set_xticks(<span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">8</span>))</span>
<span id="cb9-104"><a href="#cb9-104" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>, <span class="dv">0</span>].set_xticklabels([<span class="ss">f'T</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">'</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">8</span>)])</span>
<span id="cb9-105"><a href="#cb9-105" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>, <span class="dv">0</span>].grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb9-106"><a href="#cb9-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-107"><a href="#cb9-107" aria-hidden="true" tabindex="-1"></a><span class="co"># Add legend patches</span></span>
<span id="cb9-108"><a href="#cb9-108" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib.patches <span class="im">import</span> Patch</span>
<span id="cb9-109"><a href="#cb9-109" aria-hidden="true" tabindex="-1"></a>legend_elements <span class="op">=</span> [</span>
<span id="cb9-110"><a href="#cb9-110" aria-hidden="true" tabindex="-1"></a>    Patch(facecolor<span class="op">=</span>colors[<span class="st">'Female'</span>], edgecolor<span class="op">=</span><span class="st">'w'</span>, label<span class="op">=</span><span class="st">'Female'</span>),</span>
<span id="cb9-111"><a href="#cb9-111" aria-hidden="true" tabindex="-1"></a>    Patch(facecolor<span class="op">=</span>colors[<span class="st">'Male'</span>], edgecolor<span class="op">=</span><span class="st">'w'</span>, label<span class="op">=</span><span class="st">'Male'</span>)</span>
<span id="cb9-112"><a href="#cb9-112" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb9-113"><a href="#cb9-113" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>, <span class="dv">0</span>].legend(handles<span class="op">=</span>legend_elements, loc<span class="op">=</span><span class="st">'upper left'</span>)</span>
<span id="cb9-114"><a href="#cb9-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-115"><a href="#cb9-115" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Box plot - Age distribution at each time point</span></span>
<span id="cb9-116"><a href="#cb9-116" aria-hidden="true" tabindex="-1"></a>time_point_data <span class="op">=</span> []</span>
<span id="cb9-117"><a href="#cb9-117" aria-hidden="true" tabindex="-1"></a>labels <span class="op">=</span> []</span>
<span id="cb9-118"><a href="#cb9-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-119"><a href="#cb9-119" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">8</span>):   <span class="co"># T1 to T7</span></span>
<span id="cb9-120"><a href="#cb9-120" aria-hidden="true" tabindex="-1"></a>    col <span class="op">=</span> <span class="ss">f'age_T</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">_days'</span></span>
<span id="cb9-121"><a href="#cb9-121" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> col <span class="kw">in</span> df.columns:</span>
<span id="cb9-122"><a href="#cb9-122" aria-hidden="true" tabindex="-1"></a>        valid_data <span class="op">=</span> df[col].dropna()</span>
<span id="cb9-123"><a href="#cb9-123" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(valid_data) <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb9-124"><a href="#cb9-124" aria-hidden="true" tabindex="-1"></a>            time_point_data.append(valid_data)</span>
<span id="cb9-125"><a href="#cb9-125" aria-hidden="true" tabindex="-1"></a>            labels.append(<span class="ss">f'T</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb9-126"><a href="#cb9-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-127"><a href="#cb9-127" aria-hidden="true" tabindex="-1"></a><span class="co"># Create violin plots</span></span>
<span id="cb9-128"><a href="#cb9-128" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> time_point_data:</span>
<span id="cb9-129"><a href="#cb9-129" aria-hidden="true" tabindex="-1"></a>    violin_parts <span class="op">=</span> axs[<span class="dv">0</span>, <span class="dv">1</span>].violinplot(</span>
<span id="cb9-130"><a href="#cb9-130" aria-hidden="true" tabindex="-1"></a>        time_point_data,</span>
<span id="cb9-131"><a href="#cb9-131" aria-hidden="true" tabindex="-1"></a>        showmeans<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb9-132"><a href="#cb9-132" aria-hidden="true" tabindex="-1"></a>        showmedians<span class="op">=</span><span class="va">True</span></span>
<span id="cb9-133"><a href="#cb9-133" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb9-134"><a href="#cb9-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-135"><a href="#cb9-135" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Color the violin plots</span></span>
<span id="cb9-136"><a href="#cb9-136" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, pc <span class="kw">in</span> <span class="bu">enumerate</span>(violin_parts[<span class="st">'bodies'</span>]):</span>
<span id="cb9-137"><a href="#cb9-137" aria-hidden="true" tabindex="-1"></a>        pc.set_facecolor(<span class="st">'#7030A0'</span>)  <span class="co"># Purple</span></span>
<span id="cb9-138"><a href="#cb9-138" aria-hidden="true" tabindex="-1"></a>        pc.set_edgecolor(<span class="st">'black'</span>)</span>
<span id="cb9-139"><a href="#cb9-139" aria-hidden="true" tabindex="-1"></a>        pc.set_alpha(<span class="fl">0.7</span>)</span>
<span id="cb9-140"><a href="#cb9-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-141"><a href="#cb9-141" aria-hidden="true" tabindex="-1"></a><span class="co"># Set labels</span></span>
<span id="cb9-142"><a href="#cb9-142" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>, <span class="dv">1</span>].set_xticks(<span class="bu">range</span>(<span class="dv">1</span>, <span class="bu">len</span>(labels) <span class="op">+</span> <span class="dv">1</span>))</span>
<span id="cb9-143"><a href="#cb9-143" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>, <span class="dv">1</span>].set_xticklabels(labels)</span>
<span id="cb9-144"><a href="#cb9-144" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>, <span class="dv">1</span>].set_xlabel(<span class="st">'Time Point'</span>, fontfamily<span class="op">=</span><span class="st">'serif'</span>)</span>
<span id="cb9-145"><a href="#cb9-145" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>, <span class="dv">1</span>].set_ylabel(<span class="st">'Age (days)'</span>, fontfamily<span class="op">=</span><span class="st">'serif'</span>)</span>
<span id="cb9-146"><a href="#cb9-146" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>, <span class="dv">1</span>].set_title(<span class="st">'Age Distribution by Time Point'</span>, fontfamily<span class="op">=</span><span class="st">'serif'</span>)</span>
<span id="cb9-147"><a href="#cb9-147" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>, <span class="dv">1</span>].grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>, axis<span class="op">=</span><span class="st">'y'</span>)</span>
<span id="cb9-148"><a href="#cb9-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-149"><a href="#cb9-149" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Pie chart - Gender distribution</span></span>
<span id="cb9-150"><a href="#cb9-150" aria-hidden="true" tabindex="-1"></a>gender_counts <span class="op">=</span> df[<span class="st">'gender_label'</span>].value_counts()</span>
<span id="cb9-151"><a href="#cb9-151" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>, <span class="dv">0</span>].pie(</span>
<span id="cb9-152"><a href="#cb9-152" aria-hidden="true" tabindex="-1"></a>    gender_counts,</span>
<span id="cb9-153"><a href="#cb9-153" aria-hidden="true" tabindex="-1"></a>    labels<span class="op">=</span>gender_counts.index,</span>
<span id="cb9-154"><a href="#cb9-154" aria-hidden="true" tabindex="-1"></a>    autopct<span class="op">=</span><span class="st">'</span><span class="sc">%1.1f%%</span><span class="st">'</span>,</span>
<span id="cb9-155"><a href="#cb9-155" aria-hidden="true" tabindex="-1"></a>    colors<span class="op">=</span>[colors[g] <span class="cf">for</span> g <span class="kw">in</span> gender_counts.index],</span>
<span id="cb9-156"><a href="#cb9-156" aria-hidden="true" tabindex="-1"></a>    wedgeprops<span class="op">=</span>{<span class="st">'edgecolor'</span>: <span class="st">'w'</span>, <span class="st">'linewidth'</span>: <span class="dv">1</span>}</span>
<span id="cb9-157"><a href="#cb9-157" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-158"><a href="#cb9-158" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>, <span class="dv">0</span>].set_title(<span class="st">'Gender Distribution'</span>, fontfamily<span class="op">=</span><span class="st">'serif'</span>)</span>
<span id="cb9-159"><a href="#cb9-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-160"><a href="#cb9-160" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Summary table</span></span>
<span id="cb9-161"><a href="#cb9-161" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate averages for each time point, handling NaN values</span></span>
<span id="cb9-162"><a href="#cb9-162" aria-hidden="true" tabindex="-1"></a>averages_days <span class="op">=</span> []</span>
<span id="cb9-163"><a href="#cb9-163" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">8</span>):</span>
<span id="cb9-164"><a href="#cb9-164" aria-hidden="true" tabindex="-1"></a>    col <span class="op">=</span> <span class="ss">f'age_T</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">_days'</span></span>
<span id="cb9-165"><a href="#cb9-165" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> col <span class="kw">in</span> df.columns:</span>
<span id="cb9-166"><a href="#cb9-166" aria-hidden="true" tabindex="-1"></a>        avg <span class="op">=</span> df[col].mean()</span>
<span id="cb9-167"><a href="#cb9-167" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> pd.isna(avg):</span>
<span id="cb9-168"><a href="#cb9-168" aria-hidden="true" tabindex="-1"></a>            avg_months <span class="op">=</span> avg <span class="op">/</span> <span class="fl">30.44</span>  <span class="co"># Convert to months</span></span>
<span id="cb9-169"><a href="#cb9-169" aria-hidden="true" tabindex="-1"></a>            averages_days.append([<span class="ss">f"T</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss"> Average Age"</span>, <span class="ss">f"</span><span class="sc">{</span>avg<span class="sc">:.1f}</span><span class="ss"> days (</span><span class="sc">{</span>avg_months<span class="sc">:.1f}</span><span class="ss"> months)"</span>])</span>
<span id="cb9-170"><a href="#cb9-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-171"><a href="#cb9-171" aria-hidden="true" tabindex="-1"></a><span class="co"># Count participants at each time point</span></span>
<span id="cb9-172"><a href="#cb9-172" aria-hidden="true" tabindex="-1"></a>participants <span class="op">=</span> []</span>
<span id="cb9-173"><a href="#cb9-173" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">8</span>):</span>
<span id="cb9-174"><a href="#cb9-174" aria-hidden="true" tabindex="-1"></a>    col <span class="op">=</span> <span class="ss">f'age_T</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">_days'</span></span>
<span id="cb9-175"><a href="#cb9-175" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> col <span class="kw">in</span> df.columns:</span>
<span id="cb9-176"><a href="#cb9-176" aria-hidden="true" tabindex="-1"></a>        count <span class="op">=</span> df[col].notna().<span class="bu">sum</span>()</span>
<span id="cb9-177"><a href="#cb9-177" aria-hidden="true" tabindex="-1"></a>        participants.append([<span class="ss">f"Participants at T</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">"</span>, <span class="ss">f"</span><span class="sc">{</span>count<span class="sc">}</span><span class="ss">"</span>])</span>
<span id="cb9-178"><a href="#cb9-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-179"><a href="#cb9-179" aria-hidden="true" tabindex="-1"></a><span class="co"># Overall statistics</span></span>
<span id="cb9-180"><a href="#cb9-180" aria-hidden="true" tabindex="-1"></a>summary_data <span class="op">=</span> [</span>
<span id="cb9-181"><a href="#cb9-181" aria-hidden="true" tabindex="-1"></a>    [<span class="st">"Total Infants"</span>, <span class="ss">f"</span><span class="sc">{</span><span class="bu">len</span>(df)<span class="sc">}</span><span class="ss">"</span>],</span>
<span id="cb9-182"><a href="#cb9-182" aria-hidden="true" tabindex="-1"></a>    [<span class="st">"Females"</span>, <span class="ss">f"</span><span class="sc">{</span>(df[<span class="st">'gender'</span>] <span class="op">==</span> <span class="dv">0</span>)<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">}</span><span class="ss">"</span>],</span>
<span id="cb9-183"><a href="#cb9-183" aria-hidden="true" tabindex="-1"></a>    [<span class="st">"Males"</span>, <span class="ss">f"</span><span class="sc">{</span>(df[<span class="st">'gender'</span>] <span class="op">==</span> <span class="dv">1</span>)<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">}</span><span class="ss">"</span>]</span>
<span id="cb9-184"><a href="#cb9-184" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb9-185"><a href="#cb9-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-186"><a href="#cb9-186" aria-hidden="true" tabindex="-1"></a><span class="co"># Add age ranges if columns exist</span></span>
<span id="cb9-187"><a href="#cb9-187" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="st">'age_T1_days'</span> <span class="kw">in</span> df.columns:</span>
<span id="cb9-188"><a href="#cb9-188" aria-hidden="true" tabindex="-1"></a>    summary_data.append([<span class="st">"Age Range T1"</span>, <span class="ss">f"</span><span class="sc">{</span>df[<span class="st">'age_T1_days'</span>]<span class="sc">.</span><span class="bu">min</span>()<span class="sc">:.0f}</span><span class="ss">-</span><span class="sc">{</span>df[<span class="st">'age_T1_days'</span>]<span class="sc">.</span><span class="bu">max</span>()<span class="sc">:.0f}</span><span class="ss"> days"</span>])</span>
<span id="cb9-189"><a href="#cb9-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-190"><a href="#cb9-190" aria-hidden="true" tabindex="-1"></a>last_tp <span class="op">=</span> <span class="dv">7</span></span>
<span id="cb9-191"><a href="#cb9-191" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> last_tp <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb9-192"><a href="#cb9-192" aria-hidden="true" tabindex="-1"></a>    col <span class="op">=</span> <span class="ss">f'age_T</span><span class="sc">{</span>last_tp<span class="sc">}</span><span class="ss">_days'</span></span>
<span id="cb9-193"><a href="#cb9-193" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> col <span class="kw">in</span> df.columns <span class="kw">and</span> df[col].notna().<span class="bu">sum</span>() <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb9-194"><a href="#cb9-194" aria-hidden="true" tabindex="-1"></a>        summary_data.append([<span class="ss">f"Age Range T</span><span class="sc">{</span>last_tp<span class="sc">}</span><span class="ss">"</span>, <span class="ss">f"</span><span class="sc">{</span>df[col]<span class="sc">.</span><span class="bu">min</span>()<span class="sc">:.0f}</span><span class="ss">-</span><span class="sc">{</span>df[col]<span class="sc">.</span><span class="bu">max</span>()<span class="sc">:.0f}</span><span class="ss"> days"</span>])</span>
<span id="cb9-195"><a href="#cb9-195" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span></span>
<span id="cb9-196"><a href="#cb9-196" aria-hidden="true" tabindex="-1"></a>    last_tp <span class="op">-=</span> <span class="dv">1</span></span>
<span id="cb9-197"><a href="#cb9-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-198"><a href="#cb9-198" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the table with the most important summary statistics</span></span>
<span id="cb9-199"><a href="#cb9-199" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>, <span class="dv">1</span>].axis(<span class="st">'off'</span>)</span>
<span id="cb9-200"><a href="#cb9-200" aria-hidden="true" tabindex="-1"></a>table <span class="op">=</span> axs[<span class="dv">1</span>, <span class="dv">1</span>].table(</span>
<span id="cb9-201"><a href="#cb9-201" aria-hidden="true" tabindex="-1"></a>    cellText<span class="op">=</span>summary_data <span class="op">+</span> participants,</span>
<span id="cb9-202"><a href="#cb9-202" aria-hidden="true" tabindex="-1"></a>    loc<span class="op">=</span><span class="st">'center'</span>,</span>
<span id="cb9-203"><a href="#cb9-203" aria-hidden="true" tabindex="-1"></a>    cellLoc<span class="op">=</span><span class="st">'left'</span></span>
<span id="cb9-204"><a href="#cb9-204" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-205"><a href="#cb9-205" aria-hidden="true" tabindex="-1"></a>table.auto_set_font_size(<span class="va">False</span>)</span>
<span id="cb9-206"><a href="#cb9-206" aria-hidden="true" tabindex="-1"></a>table.set_fontsize(<span class="dv">10</span>)</span>
<span id="cb9-207"><a href="#cb9-207" aria-hidden="true" tabindex="-1"></a>table.scale(<span class="dv">1</span>, <span class="fl">1.5</span>)</span>
<span id="cb9-208"><a href="#cb9-208" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>, <span class="dv">1</span>].set_title(<span class="st">'Dataset Summary'</span>, fontfamily<span class="op">=</span><span class="st">'serif'</span>)</span>
<span id="cb9-209"><a href="#cb9-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-210"><a href="#cb9-210" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb9-211"><a href="#cb9-211" aria-hidden="true" tabindex="-1"></a>plt.subplots_adjust(top<span class="op">=</span><span class="fl">0.9</span>)</span>
<span id="cb9-212"><a href="#cb9-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-213"><a href="#cb9-213" aria-hidden="true" tabindex="-1"></a><span class="co"># Save the figure to a file</span></span>
<span id="cb9-214"><a href="#cb9-214" aria-hidden="true" tabindex="-1"></a>output_path <span class="op">=</span> <span class="st">"images/mother_infant_analysis.png"</span></span>
<span id="cb9-215"><a href="#cb9-215" aria-hidden="true" tabindex="-1"></a>os.makedirs(os.path.dirname(output_path), exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb9-216"><a href="#cb9-216" aria-hidden="true" tabindex="-1"></a>plt.savefig(output_path, dpi<span class="op">=</span><span class="dv">300</span>, bbox_inches<span class="op">=</span><span class="st">'tight'</span>)</span>
<span id="cb9-217"><a href="#cb9-217" aria-hidden="true" tabindex="-1"></a>plt.close(fig) <span class="co"># Explicitly close the figure object</span></span>
<span id="cb9-218"><a href="#cb9-218" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb9-219"><a href="#cb9-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-220"><a href="#cb9-220" aria-hidden="true" tabindex="-1"></a><span class="al">![](images/mother_infant_analysis.png)</span>{fig-align="center" width=600}</span>
<span id="cb9-221"><a href="#cb9-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-222"><a href="#cb9-222" aria-hidden="true" tabindex="-1"></a>In our github repository we use a sample data from this dataset from an infant-mother pair whom we are allowed to share the video data for the current purposes.</span>
<span id="cb9-223"><a href="#cb9-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-224"><a href="#cb9-224" aria-hidden="true" tabindex="-1"></a><span class="fu">### Dataset Siblings</span></span>
<span id="cb9-225"><a href="#cb9-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-226"><a href="#cb9-226" aria-hidden="true" tabindex="-1"></a><span class="in">```{python, eval=FALSE, code_folding="hide"}</span></span>
<span id="cb9-227"><a href="#cb9-227" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb9-228"><a href="#cb9-228" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb9-229"><a href="#cb9-229" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb9-230"><a href="#cb9-230" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb9-231"><a href="#cb9-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-232"><a href="#cb9-232" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the data</span></span>
<span id="cb9-233"><a href="#cb9-233" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">'./meta/project_siblings_metadata_ages_gender.csv'</span>)</span>
<span id="cb9-234"><a href="#cb9-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-235"><a href="#cb9-235" aria-hidden="true" tabindex="-1"></a><span class="co"># Data preprocessing</span></span>
<span id="cb9-236"><a href="#cb9-236" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'AgeDifference'</span>] <span class="op">=</span> <span class="bu">abs</span>(df[<span class="st">'P1agedays'</span>] <span class="op">-</span> df[<span class="st">'P2agedays'</span>])</span>
<span id="cb9-237"><a href="#cb9-237" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'AverageAge'</span>] <span class="op">=</span> (df[<span class="st">'P1agedays'</span>] <span class="op">+</span> df[<span class="st">'P2agedays'</span>]) <span class="op">/</span> <span class="dv">2</span></span>
<span id="cb9-238"><a href="#cb9-238" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'GenderCombo'</span>] <span class="op">=</span> df[<span class="st">'GenderP1'</span>] <span class="op">+</span> <span class="st">'-'</span> <span class="op">+</span> df[<span class="st">'GenderP2'</span>]</span>
<span id="cb9-239"><a href="#cb9-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-240"><a href="#cb9-240" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a 2x2 subplot layout</span></span>
<span id="cb9-241"><a href="#cb9-241" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">8</span>), gridspec_kw<span class="op">=</span>{<span class="st">'width_ratios'</span>: [<span class="fl">1.5</span>, <span class="dv">1</span>], <span class="st">'height_ratios'</span>: [<span class="fl">1.5</span>, <span class="dv">1</span>]})</span>
<span id="cb9-242"><a href="#cb9-242" aria-hidden="true" tabindex="-1"></a>fig.suptitle(<span class="st">'Sibling Dataset Overview'</span>, fontsize<span class="op">=</span><span class="dv">16</span>, fontfamily<span class="op">=</span><span class="st">'serif'</span>)</span>
<span id="cb9-243"><a href="#cb9-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-244"><a href="#cb9-244" aria-hidden="true" tabindex="-1"></a><span class="co"># Define colors for gender combinations</span></span>
<span id="cb9-245"><a href="#cb9-245" aria-hidden="true" tabindex="-1"></a>colors <span class="op">=</span> {</span>
<span id="cb9-246"><a href="#cb9-246" aria-hidden="true" tabindex="-1"></a>    <span class="st">'M-M'</span>: <span class="st">'#4472C4'</span>,   <span class="co"># Blue</span></span>
<span id="cb9-247"><a href="#cb9-247" aria-hidden="true" tabindex="-1"></a>    <span class="st">'M-F'</span>: <span class="st">'#7030A0'</span>,   <span class="co"># Purple</span></span>
<span id="cb9-248"><a href="#cb9-248" aria-hidden="true" tabindex="-1"></a>    <span class="st">'F-M'</span>: <span class="st">'#548235'</span>,   <span class="co"># Green</span></span>
<span id="cb9-249"><a href="#cb9-249" aria-hidden="true" tabindex="-1"></a>    <span class="st">'F-F'</span>: <span class="st">'#C55A11'</span>    <span class="co"># Rust/Orange</span></span>
<span id="cb9-250"><a href="#cb9-250" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb9-251"><a href="#cb9-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-252"><a href="#cb9-252" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Scatter plot - P1 age vs P2 age</span></span>
<span id="cb9-253"><a href="#cb9-253" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> gender_combo, group <span class="kw">in</span> df.groupby(<span class="st">'GenderCombo'</span>):</span>
<span id="cb9-254"><a href="#cb9-254" aria-hidden="true" tabindex="-1"></a>    axs[<span class="dv">0</span>, <span class="dv">0</span>].scatter(</span>
<span id="cb9-255"><a href="#cb9-255" aria-hidden="true" tabindex="-1"></a>        group[<span class="st">'P1agedays'</span>],</span>
<span id="cb9-256"><a href="#cb9-256" aria-hidden="true" tabindex="-1"></a>        group[<span class="st">'P2agedays'</span>],</span>
<span id="cb9-257"><a href="#cb9-257" aria-hidden="true" tabindex="-1"></a>        color<span class="op">=</span>colors.get(gender_combo, <span class="st">'gray'</span>),</span>
<span id="cb9-258"><a href="#cb9-258" aria-hidden="true" tabindex="-1"></a>        alpha<span class="op">=</span><span class="fl">0.7</span>,</span>
<span id="cb9-259"><a href="#cb9-259" aria-hidden="true" tabindex="-1"></a>        label<span class="op">=</span>gender_combo,</span>
<span id="cb9-260"><a href="#cb9-260" aria-hidden="true" tabindex="-1"></a>        s<span class="op">=</span><span class="dv">50</span></span>
<span id="cb9-261"><a href="#cb9-261" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb9-262"><a href="#cb9-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-263"><a href="#cb9-263" aria-hidden="true" tabindex="-1"></a><span class="co"># Add reference line</span></span>
<span id="cb9-264"><a href="#cb9-264" aria-hidden="true" tabindex="-1"></a>min_age <span class="op">=</span> <span class="bu">min</span>(df[<span class="st">'P1agedays'</span>].<span class="bu">min</span>(), df[<span class="st">'P2agedays'</span>].<span class="bu">min</span>())</span>
<span id="cb9-265"><a href="#cb9-265" aria-hidden="true" tabindex="-1"></a>max_age <span class="op">=</span> <span class="bu">max</span>(df[<span class="st">'P1agedays'</span>].<span class="bu">max</span>(), df[<span class="st">'P2agedays'</span>].<span class="bu">max</span>())</span>
<span id="cb9-266"><a href="#cb9-266" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>, <span class="dv">0</span>].plot([min_age, max_age], [min_age, max_age], <span class="st">'k--'</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb9-267"><a href="#cb9-267" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>, <span class="dv">0</span>].set_xlabel(<span class="st">'P1 Age (days)'</span>, fontfamily<span class="op">=</span><span class="st">'serif'</span>)</span>
<span id="cb9-268"><a href="#cb9-268" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>, <span class="dv">0</span>].set_ylabel(<span class="st">'P2 Age (days)'</span>, fontfamily<span class="op">=</span><span class="st">'serif'</span>)</span>
<span id="cb9-269"><a href="#cb9-269" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>, <span class="dv">0</span>].set_title(<span class="st">'Participant Ages (P1 vs P2)'</span>, fontfamily<span class="op">=</span><span class="st">'serif'</span>)</span>
<span id="cb9-270"><a href="#cb9-270" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>, <span class="dv">0</span>].grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb9-271"><a href="#cb9-271" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>, <span class="dv">0</span>].legend()</span>
<span id="cb9-272"><a href="#cb9-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-273"><a href="#cb9-273" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Bar chart - Age differences</span></span>
<span id="cb9-274"><a href="#cb9-274" aria-hidden="true" tabindex="-1"></a>bar_positions <span class="op">=</span> np.arange(<span class="bu">len</span>(df))</span>
<span id="cb9-275"><a href="#cb9-275" aria-hidden="true" tabindex="-1"></a>bar_width <span class="op">=</span> <span class="fl">0.8</span></span>
<span id="cb9-276"><a href="#cb9-276" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>, <span class="dv">1</span>].bar(</span>
<span id="cb9-277"><a href="#cb9-277" aria-hidden="true" tabindex="-1"></a>    bar_positions,</span>
<span id="cb9-278"><a href="#cb9-278" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'AgeDifference'</span>],</span>
<span id="cb9-279"><a href="#cb9-279" aria-hidden="true" tabindex="-1"></a>    width<span class="op">=</span>bar_width,</span>
<span id="cb9-280"><a href="#cb9-280" aria-hidden="true" tabindex="-1"></a>    color<span class="op">=</span>[colors.get(combo, <span class="st">'gray'</span>) <span class="cf">for</span> combo <span class="kw">in</span> df[<span class="st">'GenderCombo'</span>]]</span>
<span id="cb9-281"><a href="#cb9-281" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-282"><a href="#cb9-282" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>, <span class="dv">1</span>].set_xticks(bar_positions)</span>
<span id="cb9-283"><a href="#cb9-283" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>, <span class="dv">1</span>].set_xticklabels(df[<span class="st">'Code'</span>], rotation<span class="op">=</span><span class="dv">90</span>)</span>
<span id="cb9-284"><a href="#cb9-284" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>, <span class="dv">1</span>].set_xlabel(<span class="st">'Sibling Pair'</span>, fontfamily<span class="op">=</span><span class="st">'serif'</span>)</span>
<span id="cb9-285"><a href="#cb9-285" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>, <span class="dv">1</span>].set_ylabel(<span class="st">'Age Difference (days)'</span>, fontfamily<span class="op">=</span><span class="st">'serif'</span>)</span>
<span id="cb9-286"><a href="#cb9-286" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>, <span class="dv">1</span>].set_title(<span class="st">'Age Differences by Sibling Pair'</span>, fontfamily<span class="op">=</span><span class="st">'serif'</span>)</span>
<span id="cb9-287"><a href="#cb9-287" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>, <span class="dv">1</span>].grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>, axis<span class="op">=</span><span class="st">'y'</span>)</span>
<span id="cb9-288"><a href="#cb9-288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-289"><a href="#cb9-289" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Pie chart - Gender distribution</span></span>
<span id="cb9-290"><a href="#cb9-290" aria-hidden="true" tabindex="-1"></a>gender_counts <span class="op">=</span> df[<span class="st">'GenderCombo'</span>].value_counts()</span>
<span id="cb9-291"><a href="#cb9-291" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>, <span class="dv">0</span>].pie(</span>
<span id="cb9-292"><a href="#cb9-292" aria-hidden="true" tabindex="-1"></a>    gender_counts,</span>
<span id="cb9-293"><a href="#cb9-293" aria-hidden="true" tabindex="-1"></a>    labels<span class="op">=</span>gender_counts.index,</span>
<span id="cb9-294"><a href="#cb9-294" aria-hidden="true" tabindex="-1"></a>    autopct<span class="op">=</span><span class="st">'</span><span class="sc">%1.1f%%</span><span class="st">'</span>,</span>
<span id="cb9-295"><a href="#cb9-295" aria-hidden="true" tabindex="-1"></a>    colors<span class="op">=</span>[colors.get(combo, <span class="st">'gray'</span>) <span class="cf">for</span> combo <span class="kw">in</span> gender_counts.index],</span>
<span id="cb9-296"><a href="#cb9-296" aria-hidden="true" tabindex="-1"></a>    wedgeprops<span class="op">=</span>{<span class="st">'edgecolor'</span>: <span class="st">'w'</span>, <span class="st">'linewidth'</span>: <span class="dv">1</span>}</span>
<span id="cb9-297"><a href="#cb9-297" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-298"><a href="#cb9-298" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>, <span class="dv">0</span>].set_title(<span class="st">'Gender Distribution'</span>, fontfamily<span class="op">=</span><span class="st">'serif'</span>)</span>
<span id="cb9-299"><a href="#cb9-299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-300"><a href="#cb9-300" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Summary table</span></span>
<span id="cb9-301"><a href="#cb9-301" aria-hidden="true" tabindex="-1"></a>summary_data <span class="op">=</span> [</span>
<span id="cb9-302"><a href="#cb9-302" aria-hidden="true" tabindex="-1"></a>    [<span class="st">"Total Sibling Pairs"</span>, <span class="ss">f"</span><span class="sc">{</span><span class="bu">len</span>(df)<span class="sc">}</span><span class="ss">"</span>],</span>
<span id="cb9-303"><a href="#cb9-303" aria-hidden="true" tabindex="-1"></a>    [<span class="st">"Average P1 Age"</span>, <span class="ss">f"</span><span class="sc">{</span>df[<span class="st">'P1agedays'</span>]<span class="sc">.</span>mean()<span class="op">/</span><span class="dv">30</span><span class="sc">:.1f}</span><span class="ss"> months"</span>],</span>
<span id="cb9-304"><a href="#cb9-304" aria-hidden="true" tabindex="-1"></a>    [<span class="st">"Average P2 Age"</span>, <span class="ss">f"</span><span class="sc">{</span>df[<span class="st">'P2agedays'</span>]<span class="sc">.</span>mean()<span class="op">/</span><span class="dv">30</span><span class="sc">:.1f}</span><span class="ss"> months"</span>],</span>
<span id="cb9-305"><a href="#cb9-305" aria-hidden="true" tabindex="-1"></a>    [<span class="st">"Average Age Difference"</span>, <span class="ss">f"</span><span class="sc">{</span>df[<span class="st">'AgeDifference'</span>]<span class="sc">.</span>mean()<span class="op">/</span><span class="dv">30</span><span class="sc">:.1f}</span><span class="ss"> months"</span>],</span>
<span id="cb9-306"><a href="#cb9-306" aria-hidden="true" tabindex="-1"></a>    [<span class="st">"Number of Males"</span>, <span class="ss">f"</span><span class="sc">{</span>(df[<span class="st">'GenderP1'</span>] <span class="op">==</span> <span class="st">'M'</span>)<span class="sc">.</span><span class="bu">sum</span>() <span class="op">+</span> (df[<span class="st">'GenderP2'</span>] <span class="op">==</span> <span class="st">'M'</span>)<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">}</span><span class="ss">"</span>],</span>
<span id="cb9-307"><a href="#cb9-307" aria-hidden="true" tabindex="-1"></a>    [<span class="st">"Number of Females"</span>, <span class="ss">f"</span><span class="sc">{</span>(df[<span class="st">'GenderP1'</span>] <span class="op">==</span> <span class="st">'F'</span>)<span class="sc">.</span><span class="bu">sum</span>() <span class="op">+</span> (df[<span class="st">'GenderP2'</span>] <span class="op">==</span> <span class="st">'F'</span>)<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">}</span><span class="ss">"</span>]</span>
<span id="cb9-308"><a href="#cb9-308" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb9-309"><a href="#cb9-309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-310"><a href="#cb9-310" aria-hidden="true" tabindex="-1"></a><span class="co"># Turn off axis for table</span></span>
<span id="cb9-311"><a href="#cb9-311" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>, <span class="dv">1</span>].axis(<span class="st">'off'</span>)</span>
<span id="cb9-312"><a href="#cb9-312" aria-hidden="true" tabindex="-1"></a>table <span class="op">=</span> axs[<span class="dv">1</span>, <span class="dv">1</span>].table(</span>
<span id="cb9-313"><a href="#cb9-313" aria-hidden="true" tabindex="-1"></a>    cellText<span class="op">=</span>[row <span class="cf">for</span> row <span class="kw">in</span> summary_data],</span>
<span id="cb9-314"><a href="#cb9-314" aria-hidden="true" tabindex="-1"></a>    colLabels<span class="op">=</span>[<span class="st">"Measure"</span>, <span class="st">"Value"</span>],</span>
<span id="cb9-315"><a href="#cb9-315" aria-hidden="true" tabindex="-1"></a>    loc<span class="op">=</span><span class="st">'center'</span>,</span>
<span id="cb9-316"><a href="#cb9-316" aria-hidden="true" tabindex="-1"></a>    cellLoc<span class="op">=</span><span class="st">'left'</span></span>
<span id="cb9-317"><a href="#cb9-317" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-318"><a href="#cb9-318" aria-hidden="true" tabindex="-1"></a>table.auto_set_font_size(<span class="va">False</span>)</span>
<span id="cb9-319"><a href="#cb9-319" aria-hidden="true" tabindex="-1"></a>table.set_fontsize(<span class="dv">10</span>)</span>
<span id="cb9-320"><a href="#cb9-320" aria-hidden="true" tabindex="-1"></a>table.scale(<span class="dv">1</span>, <span class="fl">1.5</span>)</span>
<span id="cb9-321"><a href="#cb9-321" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>, <span class="dv">1</span>].set_title(<span class="st">'Dataset Summary'</span>, fontfamily<span class="op">=</span><span class="st">'serif'</span>)</span>
<span id="cb9-322"><a href="#cb9-322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-323"><a href="#cb9-323" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb9-324"><a href="#cb9-324" aria-hidden="true" tabindex="-1"></a>plt.subplots_adjust(top<span class="op">=</span><span class="fl">0.9</span>)</span>
<span id="cb9-325"><a href="#cb9-325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-326"><a href="#cb9-326" aria-hidden="true" tabindex="-1"></a><span class="co"># Save the figure to a file</span></span>
<span id="cb9-327"><a href="#cb9-327" aria-hidden="true" tabindex="-1"></a>output_path <span class="op">=</span> <span class="st">"images/sibling_analysis.png"</span></span>
<span id="cb9-328"><a href="#cb9-328" aria-hidden="true" tabindex="-1"></a>os.makedirs(os.path.dirname(output_path), exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb9-329"><a href="#cb9-329" aria-hidden="true" tabindex="-1"></a>plt.savefig(output_path, dpi<span class="op">=</span><span class="dv">300</span>, bbox_inches<span class="op">=</span><span class="st">'tight'</span>)</span>
<span id="cb9-330"><a href="#cb9-330" aria-hidden="true" tabindex="-1"></a>plt.close()</span>
<span id="cb9-331"><a href="#cb9-331" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb9-332"><a href="#cb9-332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-333"><a href="#cb9-333" aria-hidden="true" tabindex="-1"></a><span class="al">![](images/sibling_analysis.png)</span>{fig-align="center" width=600}</span>
<span id="cb9-334"><a href="#cb9-334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-335"><a href="#cb9-335" aria-hidden="true" tabindex="-1"></a>::: {.callout-note .callout-settingup collapse="true"}</span>
<span id="cb9-336"><a href="#cb9-336" aria-hidden="true" tabindex="-1"></a><span class="fu">## Setting up 🛠️</span></span>
<span id="cb9-337"><a href="#cb9-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-338"><a href="#cb9-338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-339"><a href="#cb9-339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-340"><a href="#cb9-340" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb9-341"><a href="#cb9-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-342"><a href="#cb9-342" aria-hidden="true" tabindex="-1"></a><span class="fu"># Motion tracking and signal processing and wrangling</span></span>
<span id="cb9-343"><a href="#cb9-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-344"><a href="#cb9-344" aria-hidden="true" tabindex="-1"></a>The motion tracking and signal processing pipeline is divided into two main steps: </span>
<span id="cb9-345"><a href="#cb9-345" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**Tracking**: This step involves tracking the movements of individuals in the videos using a pose estimation model. The output is a video with annotated keypoints and a CSV file containing the coordinates of these keypoints.</span>
<span id="cb9-346"><a href="#cb9-346" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**Signal Processing**: This step involves processing the keypoint data to extract relevant features for analysis. The output are processed timeseries files, and a flat dataset containing our smoothness measures that are directly ready for statistical analysis.</span>
<span id="cb9-347"><a href="#cb9-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-348"><a href="#cb9-348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-349"><a href="#cb9-349" aria-hidden="true" tabindex="-1"></a><span class="fu">## Step 1: Tracking two persons in videos for top-view (Python)</span></span>
<span id="cb9-350"><a href="#cb9-350" aria-hidden="true" tabindex="-1"></a>We have tried several pose tracking solutions, such as OpenPose (model 25B; @caoOpenPoseRealtimeMultiPerson2021), Mediapipe (default highest complexity blazepose model; @lugaresiMediaPipeFrameworkBuilding2019) and we found that these models are not well equipped to track persons from top view, most likely because these models are not trained on ground-truth poses of persons from top-view camera angles. However, we found the heaviest model of yolo v8 ("yolov8x-pose-p6.pt") does perform very well, especially as compared to the other models we tested. Thus, for this pipeline we recommend using YOLOv8 model for top-view tracking.</span>
<span id="cb9-351"><a href="#cb9-351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-352"><a href="#cb9-352" aria-hidden="true" tabindex="-1"></a>::: {.callout-note .callout-installation collapse="true"}</span>
<span id="cb9-353"><a href="#cb9-353" aria-hidden="true" tabindex="-1"></a><span class="fu">## Installation Guide 🛠️</span></span>
<span id="cb9-354"><a href="#cb9-354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-355"><a href="#cb9-355" aria-hidden="true" tabindex="-1"></a><span class="fu">### Step 0: Github repo</span></span>
<span id="cb9-356"><a href="#cb9-356" aria-hidden="true" tabindex="-1"></a>We assume you have cloned the repository <span class="co">[</span><span class="ot">InterPerDynPipeline</span><span class="co">](https://github.com/WimPouw/InterPerDynPipeline)</span> and are in the root directory. The step 1 code for tracking is in the <span class="in">`./code_STEP1_posetrackingprocessing/`</span> folder. In this folder you will find the Python script <span class="in">`yolo_tracking_processing.py`</span>. To check whether you have the correct script you can compare against the code chunk provided below.</span>
<span id="cb9-357"><a href="#cb9-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-358"><a href="#cb9-358" aria-hidden="true" tabindex="-1"></a><span class="fu">### Step 1: Install requirements</span></span>
<span id="cb9-359"><a href="#cb9-359" aria-hidden="true" tabindex="-1"></a>For each script we have provided a <span class="in">`requirements.txt`</span> file. You can install the requirements using pip, by first navigating to the folder where the script is located and then running the following command in your terminal:</span>
<span id="cb9-360"><a href="#cb9-360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-361"><a href="#cb9-361" aria-hidden="true" tabindex="-1"></a><span class="in">```bash</span></span>
<span id="cb9-362"><a href="#cb9-362" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> <span class="pp">[</span><span class="ss">yourspecificrootadress</span><span class="pp">]</span>/code_STEP1_posetrackingprocessing/</span>
<span id="cb9-363"><a href="#cb9-363" aria-hidden="true" tabindex="-1"></a><span class="ex">pip</span> install <span class="at">-r</span> requirements.txt</span>
<span id="cb9-364"><a href="#cb9-364" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb9-365"><a href="#cb9-365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-366"><a href="#cb9-366" aria-hidden="true" tabindex="-1"></a><span class="fu">### Step 2: Download the YOLOv8 model</span></span>
<span id="cb9-367"><a href="#cb9-367" aria-hidden="true" tabindex="-1"></a>In the current GitHub repo we have a light-weight model <span class="in">`yolov8n-pose.pt`</span> (~6.5MB) for immediate testing of the code. However, this model is not as accurate as the heaviest model.</span>
<span id="cb9-368"><a href="#cb9-368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-369"><a href="#cb9-369" aria-hidden="true" tabindex="-1"></a>We should download the heaviest model (<span class="in">`yolov8x-pose-p6.pt`</span>) and save it to the <span class="in">`./code_STEP1_posetrackingprocessing/model/`</span> directory:  </span>
<span id="cb9-370"><a href="#cb9-370" aria-hidden="true" tabindex="-1"></a>https://github.com/ultralytics/assets/releases/download/v8.1.0/yolov8x-pose-p6.pt</span>
<span id="cb9-371"><a href="#cb9-371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-372"><a href="#cb9-372" aria-hidden="true" tabindex="-1"></a>**Note**: If you're running the heavyweight model, you will need GPU support for this to run in a reasonable time. The lightweight model can run on CPU.</span>
<span id="cb9-373"><a href="#cb9-373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-374"><a href="#cb9-374" aria-hidden="true" tabindex="-1"></a><span class="fu">### Step 3: Run the python script</span></span>
<span id="cb9-375"><a href="#cb9-375" aria-hidden="true" tabindex="-1"></a>Assuming you have videos in your data folder (<span class="in">`./data_raw/`</span>) and you have a <span class="in">`.pt`</span> model in the model folder, you can run the script using the following command:</span>
<span id="cb9-376"><a href="#cb9-376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-377"><a href="#cb9-377" aria-hidden="true" tabindex="-1"></a><span class="in">```bash</span></span>
<span id="cb9-378"><a href="#cb9-378" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> <span class="pp">[</span><span class="ss">yourspecificrootadress</span><span class="pp">]</span>/code_STEP1_posetrackingprocessing/</span>
<span id="cb9-379"><a href="#cb9-379" aria-hidden="true" tabindex="-1"></a><span class="ex">python</span> yolo_tracking_processing.py</span>
<span id="cb9-380"><a href="#cb9-380" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb9-381"><a href="#cb9-381" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb9-382"><a href="#cb9-382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-383"><a href="#cb9-383" aria-hidden="true" tabindex="-1"></a>The code below is the script <span class="in">`yolo_tracking_processing.py`</span> that you can run to track the videos. The output will be a video with annotated keypoints and a CSV file containing the coordinates of these keypoints. The script processes each video frame-by-frame, detecting people and their pose keypoints (17 points as listed in the script; see the <span class="in">`GetKeypoint class`</span>). We filter out duplicate detections or skeletons with excessive missing data. Specifically, for each processed video, the script generates two output files: an annotated video showing the original footage with skeleton overlays (green points for accepted keypoints, red for filtered ones, and blue lines connecting the points), and a CSV file containing the raw coordinate data (frame number, person ID, keypoint ID, x-coordinate, y-coordinate). The output filenames include parameters like "c150" (150px proximity threshold) and "miss95" (95% missing data tolerance), which control how the system handles potential duplicate detections and incomplete skeletons. The user could adjust the parameter <span class="in">`close_threshold`</span> and <span class="in">`miss_tolerance`</span> to adjust the detection dynamics. We output the annotated video and the CSV file in the <span class="in">`./datatracked_afterSTEP1/`</span> folder.</span>
<span id="cb9-384"><a href="#cb9-384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-385"><a href="#cb9-385" aria-hidden="true" tabindex="-1"></a><span class="in">```{python, eval=FALSE, code_folding="hide"}</span></span>
<span id="cb9-386"><a href="#cb9-386" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> ultralytics <span class="im">import</span> YOLO</span>
<span id="cb9-387"><a href="#cb9-387" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pydantic <span class="im">import</span> BaseModel</span>
<span id="cb9-388"><a href="#cb9-388" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> cv2</span>
<span id="cb9-389"><a href="#cb9-389" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> csv</span>
<span id="cb9-390"><a href="#cb9-390" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb9-391"><a href="#cb9-391" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> glob</span>
<span id="cb9-392"><a href="#cb9-392" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb9-393"><a href="#cb9-393" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch <span class="co"># for gpu support</span></span>
<span id="cb9-394"><a href="#cb9-394" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> itertools <span class="im">import</span> combinations</span>
<span id="cb9-395"><a href="#cb9-395" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb9-396"><a href="#cb9-396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-397"><a href="#cb9-397" aria-hidden="true" tabindex="-1"></a>torch.cuda.set_device(<span class="dv">0</span>)</span>
<span id="cb9-398"><a href="#cb9-398" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the model</span></span>
<span id="cb9-399"><a href="#cb9-399" aria-hidden="true" tabindex="-1"></a>modelfolder <span class="op">=</span> <span class="st">'./model/'</span></span>
<span id="cb9-400"><a href="#cb9-400" aria-hidden="true" tabindex="-1"></a>modellocation <span class="op">=</span> glob.glob(modelfolder<span class="op">+</span><span class="st">"*.pt"</span>)[<span class="dv">0</span>]</span>
<span id="cb9-401"><a href="#cb9-401" aria-hidden="true" tabindex="-1"></a>modelfile <span class="op">=</span> os.path.basename(modellocation)</span>
<span id="cb9-402"><a href="#cb9-402" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"We are loading in the following YOLO model: </span><span class="sc">{</span>modelfile<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb9-403"><a href="#cb9-403" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> YOLO(modellocation)</span>
<span id="cb9-404"><a href="#cb9-404" aria-hidden="true" tabindex="-1"></a><span class="co"># main variables</span></span>
<span id="cb9-405"><a href="#cb9-405" aria-hidden="true" tabindex="-1"></a>video_folder <span class="op">=</span> <span class="st">"../data_raw/"</span></span>
<span id="cb9-406"><a href="#cb9-406" aria-hidden="true" tabindex="-1"></a><span class="co"># avi mp4 or other video formats</span></span>
<span id="cb9-407"><a href="#cb9-407" aria-hidden="true" tabindex="-1"></a>video_files <span class="op">=</span> glob.glob(video_folder <span class="op">+</span> <span class="st">"*.mp4"</span>) <span class="op">+</span> glob.glob(video_folder <span class="op">+</span> <span class="st">"*.avi"</span>) <span class="op">+</span> glob.glob(video_folder <span class="op">+</span> <span class="st">"*.mov"</span>) <span class="op">+</span> glob.glob(video_folder <span class="op">+</span> <span class="st">"*.mkv"</span>)</span>
<span id="cb9-408"><a href="#cb9-408" aria-hidden="true" tabindex="-1"></a>step1resultfolder <span class="op">=</span> <span class="st">"../datatracked_afterSTEP1/"</span></span>
<span id="cb9-409"><a href="#cb9-409" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(video_files)</span>
<span id="cb9-410"><a href="#cb9-410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-411"><a href="#cb9-411" aria-hidden="true" tabindex="-1"></a><span class="co"># keypoint names</span></span>
<span id="cb9-412"><a href="#cb9-412" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> GetKeypoint(BaseModel):</span>
<span id="cb9-413"><a href="#cb9-413" aria-hidden="true" tabindex="-1"></a>    NOSE:           <span class="bu">int</span> <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb9-414"><a href="#cb9-414" aria-hidden="true" tabindex="-1"></a>    LEFT_EYE:       <span class="bu">int</span> <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb9-415"><a href="#cb9-415" aria-hidden="true" tabindex="-1"></a>    RIGHT_EYE:      <span class="bu">int</span> <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb9-416"><a href="#cb9-416" aria-hidden="true" tabindex="-1"></a>    LEFT_EAR:       <span class="bu">int</span> <span class="op">=</span> <span class="dv">3</span></span>
<span id="cb9-417"><a href="#cb9-417" aria-hidden="true" tabindex="-1"></a>    RIGHT_EAR:      <span class="bu">int</span> <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb9-418"><a href="#cb9-418" aria-hidden="true" tabindex="-1"></a>    LEFT_SHOULDER:  <span class="bu">int</span> <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb9-419"><a href="#cb9-419" aria-hidden="true" tabindex="-1"></a>    RIGHT_SHOULDER: <span class="bu">int</span> <span class="op">=</span> <span class="dv">6</span></span>
<span id="cb9-420"><a href="#cb9-420" aria-hidden="true" tabindex="-1"></a>    LEFT_ELBOW:     <span class="bu">int</span> <span class="op">=</span> <span class="dv">7</span></span>
<span id="cb9-421"><a href="#cb9-421" aria-hidden="true" tabindex="-1"></a>    RIGHT_ELBOW:    <span class="bu">int</span> <span class="op">=</span> <span class="dv">8</span></span>
<span id="cb9-422"><a href="#cb9-422" aria-hidden="true" tabindex="-1"></a>    LEFT_WRIST:     <span class="bu">int</span> <span class="op">=</span> <span class="dv">9</span></span>
<span id="cb9-423"><a href="#cb9-423" aria-hidden="true" tabindex="-1"></a>    RIGHT_WRIST:    <span class="bu">int</span> <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb9-424"><a href="#cb9-424" aria-hidden="true" tabindex="-1"></a>    LEFT_HIP:       <span class="bu">int</span> <span class="op">=</span> <span class="dv">11</span></span>
<span id="cb9-425"><a href="#cb9-425" aria-hidden="true" tabindex="-1"></a>    RIGHT_HIP:      <span class="bu">int</span> <span class="op">=</span> <span class="dv">12</span></span>
<span id="cb9-426"><a href="#cb9-426" aria-hidden="true" tabindex="-1"></a>    LEFT_KNEE:      <span class="bu">int</span> <span class="op">=</span> <span class="dv">13</span></span>
<span id="cb9-427"><a href="#cb9-427" aria-hidden="true" tabindex="-1"></a>    RIGHT_KNEE:     <span class="bu">int</span> <span class="op">=</span> <span class="dv">14</span></span>
<span id="cb9-428"><a href="#cb9-428" aria-hidden="true" tabindex="-1"></a>    LEFT_ANKLE:     <span class="bu">int</span> <span class="op">=</span> <span class="dv">15</span></span>
<span id="cb9-429"><a href="#cb9-429" aria-hidden="true" tabindex="-1"></a>    RIGHT_ANKLE:    <span class="bu">int</span> <span class="op">=</span> <span class="dv">16</span></span>
<span id="cb9-430"><a href="#cb9-430" aria-hidden="true" tabindex="-1"></a>get_keypoint <span class="op">=</span> GetKeypoint()</span>
<span id="cb9-431"><a href="#cb9-431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-432"><a href="#cb9-432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-433"><a href="#cb9-433" aria-hidden="true" tabindex="-1"></a><span class="co"># Define skeleton connections</span></span>
<span id="cb9-434"><a href="#cb9-434" aria-hidden="true" tabindex="-1"></a>skeleton <span class="op">=</span> [</span>
<span id="cb9-435"><a href="#cb9-435" aria-hidden="true" tabindex="-1"></a>    (get_keypoint.LEFT_SHOULDER, get_keypoint.RIGHT_SHOULDER),</span>
<span id="cb9-436"><a href="#cb9-436" aria-hidden="true" tabindex="-1"></a>    (get_keypoint.LEFT_SHOULDER, get_keypoint.LEFT_ELBOW),</span>
<span id="cb9-437"><a href="#cb9-437" aria-hidden="true" tabindex="-1"></a>    (get_keypoint.RIGHT_SHOULDER, get_keypoint.RIGHT_ELBOW),</span>
<span id="cb9-438"><a href="#cb9-438" aria-hidden="true" tabindex="-1"></a>    (get_keypoint.LEFT_ELBOW, get_keypoint.LEFT_WRIST),</span>
<span id="cb9-439"><a href="#cb9-439" aria-hidden="true" tabindex="-1"></a>    (get_keypoint.RIGHT_ELBOW, get_keypoint.RIGHT_WRIST),</span>
<span id="cb9-440"><a href="#cb9-440" aria-hidden="true" tabindex="-1"></a>    (get_keypoint.LEFT_SHOULDER, get_keypoint.LEFT_HIP),</span>
<span id="cb9-441"><a href="#cb9-441" aria-hidden="true" tabindex="-1"></a>    (get_keypoint.RIGHT_SHOULDER, get_keypoint.RIGHT_HIP),</span>
<span id="cb9-442"><a href="#cb9-442" aria-hidden="true" tabindex="-1"></a>    (get_keypoint.LEFT_HIP, get_keypoint.RIGHT_HIP),</span>
<span id="cb9-443"><a href="#cb9-443" aria-hidden="true" tabindex="-1"></a>    (get_keypoint.LEFT_HIP, get_keypoint.LEFT_KNEE),</span>
<span id="cb9-444"><a href="#cb9-444" aria-hidden="true" tabindex="-1"></a>    (get_keypoint.RIGHT_HIP, get_keypoint.RIGHT_KNEE),</span>
<span id="cb9-445"><a href="#cb9-445" aria-hidden="true" tabindex="-1"></a>    (get_keypoint.LEFT_KNEE, get_keypoint.LEFT_ANKLE),</span>
<span id="cb9-446"><a href="#cb9-446" aria-hidden="true" tabindex="-1"></a>    (get_keypoint.RIGHT_KNEE, get_keypoint.RIGHT_ANKLE),</span>
<span id="cb9-447"><a href="#cb9-447" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb9-448"><a href="#cb9-448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-449"><a href="#cb9-449" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> tensor_to_matrix(results_tensor):</span>
<span id="cb9-450"><a href="#cb9-450" aria-hidden="true" tabindex="-1"></a>    <span class="co"># this just takes the results output of YOLO and coverts it to a matrix,</span></span>
<span id="cb9-451"><a href="#cb9-451" aria-hidden="true" tabindex="-1"></a>    <span class="co"># making it easier to do quick calculations on the coordinates</span></span>
<span id="cb9-452"><a href="#cb9-452" aria-hidden="true" tabindex="-1"></a>    results_list <span class="op">=</span> results_tensor.tolist()</span>
<span id="cb9-453"><a href="#cb9-453" aria-hidden="true" tabindex="-1"></a>    results_matrix <span class="op">=</span> np.matrix(results_list)</span>
<span id="cb9-454"><a href="#cb9-454" aria-hidden="true" tabindex="-1"></a>    results_matrix[results_matrix<span class="op">==</span><span class="dv">0</span>] <span class="op">=</span> np.nan</span>
<span id="cb9-455"><a href="#cb9-455" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> results_matrix</span>
<span id="cb9-456"><a href="#cb9-456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-457"><a href="#cb9-457" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> check_for_duplication(results):</span>
<span id="cb9-458"><a href="#cb9-458" aria-hidden="true" tabindex="-1"></a>    <span class="co"># this threshold determines how close two skeletons must be in order to be</span></span>
<span id="cb9-459"><a href="#cb9-459" aria-hidden="true" tabindex="-1"></a>    <span class="co"># considered the same person. Arbitrarily chosen for now.</span></span>
<span id="cb9-460"><a href="#cb9-460" aria-hidden="true" tabindex="-1"></a>    close_threshold <span class="op">=</span><span class="dv">150</span></span>
<span id="cb9-461"><a href="#cb9-461" aria-hidden="true" tabindex="-1"></a>    <span class="co"># missing data tolerance</span></span>
<span id="cb9-462"><a href="#cb9-462" aria-hidden="true" tabindex="-1"></a>    miss_tolerance <span class="op">=</span> <span class="fl">0.95</span> <span class="co"># this means we can miss up to 75% of the keypoints</span></span>
<span id="cb9-463"><a href="#cb9-463" aria-hidden="true" tabindex="-1"></a>    drop_indices <span class="op">=</span> []</span>
<span id="cb9-464"><a href="#cb9-464" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(results[<span class="dv">0</span>].keypoints.xy) <span class="op">&gt;</span> <span class="dv">1</span>:</span>
<span id="cb9-465"><a href="#cb9-465" aria-hidden="true" tabindex="-1"></a>        conf_scores <span class="op">=</span> []</span>
<span id="cb9-466"><a href="#cb9-466" aria-hidden="true" tabindex="-1"></a>        <span class="co"># get detection confidence for each skeleton</span></span>
<span id="cb9-467"><a href="#cb9-467" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> person <span class="kw">in</span> tensor_to_matrix(results[<span class="dv">0</span>].keypoints.conf):</span>
<span id="cb9-468"><a href="#cb9-468" aria-hidden="true" tabindex="-1"></a>            conf_scores.append(np.mean(person))</span>
<span id="cb9-469"><a href="#cb9-469" aria-hidden="true" tabindex="-1"></a>           </span>
<span id="cb9-470"><a href="#cb9-470" aria-hidden="true" tabindex="-1"></a>        <span class="co"># this list will stores which comparisons need to be made</span></span>
<span id="cb9-471"><a href="#cb9-471" aria-hidden="true" tabindex="-1"></a>        combos <span class="op">=</span> <span class="bu">list</span>(combinations(<span class="bu">range</span>(<span class="bu">len</span>(results[<span class="dv">0</span>].keypoints.xy)), <span class="dv">2</span>))</span>
<span id="cb9-472"><a href="#cb9-472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-473"><a href="#cb9-473" aria-hidden="true" tabindex="-1"></a>        <span class="co"># now loop through these comparisons</span></span>
<span id="cb9-474"><a href="#cb9-474" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> combo <span class="kw">in</span> combos:</span>
<span id="cb9-475"><a href="#cb9-475" aria-hidden="true" tabindex="-1"></a>            closeness <span class="op">=</span> <span class="bu">abs</span>(np.nanmean(tensor_to_matrix(results[<span class="dv">0</span>].keypoints.xy[combo[<span class="dv">0</span>]]) <span class="op">-</span> </span>
<span id="cb9-476"><a href="#cb9-476" aria-hidden="true" tabindex="-1"></a>                        tensor_to_matrix(results[<span class="dv">0</span>].keypoints.xy[combo[<span class="dv">1</span>]])))</span>
<span id="cb9-477"><a href="#cb9-477" aria-hidden="true" tabindex="-1"></a>            <span class="co"># if any of them indicate that two skeletons are very close together,</span></span>
<span id="cb9-478"><a href="#cb9-478" aria-hidden="true" tabindex="-1"></a>            <span class="co"># we keep the one with higher tracking confidence, and remove the other</span></span>
<span id="cb9-479"><a href="#cb9-479" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> closeness <span class="op">&lt;</span> close_threshold:</span>
<span id="cb9-480"><a href="#cb9-480" aria-hidden="true" tabindex="-1"></a>                conf_list <span class="op">=</span> [conf_scores[combo[<span class="dv">0</span>]], conf_scores[combo[<span class="dv">1</span>]]]</span>
<span id="cb9-481"><a href="#cb9-481" aria-hidden="true" tabindex="-1"></a>                idx_min <span class="op">=</span> conf_list.index(<span class="bu">min</span>(conf_list))</span>
<span id="cb9-482"><a href="#cb9-482" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-483"><a href="#cb9-483" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb9-484"><a href="#cb9-484" aria-hidden="true" tabindex="-1"></a>                drop_indices.append(combo[idx_min])</span>
<span id="cb9-485"><a href="#cb9-485" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb9-486"><a href="#cb9-486" aria-hidden="true" tabindex="-1"></a>        <span class="co"># additional checks:</span></span>
<span id="cb9-487"><a href="#cb9-487" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> person <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(results[<span class="dv">0</span>].keypoints.xy)):</span>
<span id="cb9-488"><a href="#cb9-488" aria-hidden="true" tabindex="-1"></a>           keypoints_missed <span class="op">=</span>  np.isnan(tensor_to_matrix(results[<span class="dv">0</span>].keypoints.xy[person])).<span class="bu">sum</span>()<span class="op">/</span><span class="dv">2</span></span>
<span id="cb9-489"><a href="#cb9-489" aria-hidden="true" tabindex="-1"></a>           perc_missed <span class="op">=</span> keypoints_missed<span class="op">/</span><span class="bu">len</span>(tensor_to_matrix(results[<span class="dv">0</span>].keypoints.xy[person]))</span>
<span id="cb9-490"><a href="#cb9-490" aria-hidden="true" tabindex="-1"></a>           </span>
<span id="cb9-491"><a href="#cb9-491" aria-hidden="true" tabindex="-1"></a>           <span class="cf">if</span> perc_missed <span class="op">&gt;</span> miss_tolerance:</span>
<span id="cb9-492"><a href="#cb9-492" aria-hidden="true" tabindex="-1"></a>               drop_indices.append(person)</span>
<span id="cb9-493"><a href="#cb9-493" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-494"><a href="#cb9-494" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">list</span>(<span class="bu">set</span>(drop_indices))</span>
<span id="cb9-495"><a href="#cb9-495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-496"><a href="#cb9-496" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-497"><a href="#cb9-497" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> video_path <span class="kw">in</span> video_files:</span>
<span id="cb9-498"><a href="#cb9-498" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Video path</span></span>
<span id="cb9-499"><a href="#cb9-499" aria-hidden="true" tabindex="-1"></a>    video_path <span class="op">=</span> video_path</span>
<span id="cb9-500"><a href="#cb9-500" aria-hidden="true" tabindex="-1"></a>    <span class="co"># only if the output is not there yet</span></span>
<span id="cb9-501"><a href="#cb9-501" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> os.path.exists(step1resultfolder<span class="op">+</span> os.path.basename(video_path).split(<span class="st">'.'</span>)[<span class="dv">0</span>]<span class="op">+</span><span class="st">"_annotated_layer1_c150_miss95.mp4"</span>):</span>
<span id="cb9-502"><a href="#cb9-502" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Output video already exists for </span><span class="sc">{</span>video_path<span class="sc">}</span><span class="ss">. Skipping..."</span>)</span>
<span id="cb9-503"><a href="#cb9-503" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb9-504"><a href="#cb9-504" aria-hidden="true" tabindex="-1"></a>    <span class="co"># vidname without extension</span></span>
<span id="cb9-505"><a href="#cb9-505" aria-hidden="true" tabindex="-1"></a>    vidname <span class="op">=</span> os.path.basename(video_path)</span>
<span id="cb9-506"><a href="#cb9-506" aria-hidden="true" tabindex="-1"></a>    vidname <span class="op">=</span> vidname.split(<span class="st">'.'</span>)[<span class="dv">0</span>]</span>
<span id="cb9-507"><a href="#cb9-507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-508"><a href="#cb9-508" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Open the video</span></span>
<span id="cb9-509"><a href="#cb9-509" aria-hidden="true" tabindex="-1"></a>    cap <span class="op">=</span> cv2.VideoCapture(video_path)</span>
<span id="cb9-510"><a href="#cb9-510" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-511"><a href="#cb9-511" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get video properties</span></span>
<span id="cb9-512"><a href="#cb9-512" aria-hidden="true" tabindex="-1"></a>    fps <span class="op">=</span> <span class="bu">int</span>(cap.get(cv2.CAP_PROP_FPS))</span>
<span id="cb9-513"><a href="#cb9-513" aria-hidden="true" tabindex="-1"></a>    width <span class="op">=</span> <span class="bu">int</span>(cap.get(cv2.CAP_PROP_FRAME_WIDTH))</span>
<span id="cb9-514"><a href="#cb9-514" aria-hidden="true" tabindex="-1"></a>    height <span class="op">=</span> <span class="bu">int</span>(cap.get(cv2.CAP_PROP_FRAME_HEIGHT))</span>
<span id="cb9-515"><a href="#cb9-515" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-516"><a href="#cb9-516" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Define the output video writer</span></span>
<span id="cb9-517"><a href="#cb9-517" aria-hidden="true" tabindex="-1"></a>    corename <span class="op">=</span> os.path.basename(video_path).split(<span class="st">'.'</span>)[<span class="dv">0</span>]</span>
<span id="cb9-518"><a href="#cb9-518" aria-hidden="true" tabindex="-1"></a>    output_path <span class="op">=</span> step1resultfolder<span class="op">+</span> vidname<span class="op">+</span><span class="st">"_annotated_layer1_c150_miss95.mp4"</span></span>
<span id="cb9-519"><a href="#cb9-519" aria-hidden="true" tabindex="-1"></a>    fourcc <span class="op">=</span> cv2.VideoWriter_fourcc(<span class="op">*</span><span class="st">'mp4v'</span>)</span>
<span id="cb9-520"><a href="#cb9-520" aria-hidden="true" tabindex="-1"></a>    out <span class="op">=</span> cv2.VideoWriter(output_path, fourcc, fps, (width, height))</span>
<span id="cb9-521"><a href="#cb9-521" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-522"><a href="#cb9-522" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Prepare CSV file</span></span>
<span id="cb9-523"><a href="#cb9-523" aria-hidden="true" tabindex="-1"></a>    csv_path <span class="op">=</span> step1resultfolder<span class="op">+</span> vidname<span class="op">+</span><span class="st">'_keypoints_data_layer1.csv'</span></span>
<span id="cb9-524"><a href="#cb9-524" aria-hidden="true" tabindex="-1"></a>    csv_file <span class="op">=</span> <span class="bu">open</span>(csv_path, <span class="st">'w'</span>, newline<span class="op">=</span><span class="st">''</span>)</span>
<span id="cb9-525"><a href="#cb9-525" aria-hidden="true" tabindex="-1"></a>    csv_writer <span class="op">=</span> csv.writer(csv_file)</span>
<span id="cb9-526"><a href="#cb9-526" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-527"><a href="#cb9-527" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Write header</span></span>
<span id="cb9-528"><a href="#cb9-528" aria-hidden="true" tabindex="-1"></a>    header <span class="op">=</span> [<span class="st">'frame'</span>, <span class="st">'person'</span>, <span class="st">'keypoint'</span>, <span class="st">'x'</span>, <span class="st">'y'</span>]</span>
<span id="cb9-529"><a href="#cb9-529" aria-hidden="true" tabindex="-1"></a>    csv_writer.writerow(header)</span>
<span id="cb9-530"><a href="#cb9-530" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-531"><a href="#cb9-531" aria-hidden="true" tabindex="-1"></a>    frame_count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb9-532"><a href="#cb9-532" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-533"><a href="#cb9-533" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> cap.isOpened():</span>
<span id="cb9-534"><a href="#cb9-534" aria-hidden="true" tabindex="-1"></a>        success, frame <span class="op">=</span> cap.read()</span>
<span id="cb9-535"><a href="#cb9-535" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> success:</span>
<span id="cb9-536"><a href="#cb9-536" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb9-537"><a href="#cb9-537" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-538"><a href="#cb9-538" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Run YOLOv8 inference on the frame</span></span>
<span id="cb9-539"><a href="#cb9-539" aria-hidden="true" tabindex="-1"></a>        results <span class="op">=</span> model(frame)</span>
<span id="cb9-540"><a href="#cb9-540" aria-hidden="true" tabindex="-1"></a>               </span>
<span id="cb9-541"><a href="#cb9-541" aria-hidden="true" tabindex="-1"></a>        <span class="co"># write empty rows if no person is detected</span></span>
<span id="cb9-542"><a href="#cb9-542" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(results[<span class="dv">0</span>].keypoints.xy) <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb9-543"><a href="#cb9-543" aria-hidden="true" tabindex="-1"></a>            csv_writer.writerow([frame_count, <span class="va">None</span>, <span class="va">None</span>, <span class="va">None</span>, <span class="va">None</span>])</span>
<span id="cb9-544"><a href="#cb9-544" aria-hidden="true" tabindex="-1"></a>        annotated_frame <span class="op">=</span> frame</span>
<span id="cb9-545"><a href="#cb9-545" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-546"><a href="#cb9-546" aria-hidden="true" tabindex="-1"></a>        <span class="co"># only do this if a person is detected</span></span>
<span id="cb9-547"><a href="#cb9-547" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(results[<span class="dv">0</span>].keypoints.xy) <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb9-548"><a href="#cb9-548" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Process the results</span></span>
<span id="cb9-549"><a href="#cb9-549" aria-hidden="true" tabindex="-1"></a>            drop_indices <span class="op">=</span> []</span>
<span id="cb9-550"><a href="#cb9-550" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb9-551"><a href="#cb9-551" aria-hidden="true" tabindex="-1"></a>            drop_indices <span class="op">=</span> check_for_duplication(results)</span>
<span id="cb9-552"><a href="#cb9-552" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb9-553"><a href="#cb9-553" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb9-554"><a href="#cb9-554" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> person_idx, person_keypoints <span class="kw">in</span> <span class="bu">enumerate</span>(results[<span class="dv">0</span>].keypoints.xy):</span>
<span id="cb9-555"><a href="#cb9-555" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> person_idx <span class="kw">not</span> <span class="kw">in</span> drop_indices:</span>
<span id="cb9-556"><a href="#cb9-556" aria-hidden="true" tabindex="-1"></a>                    colourcode <span class="op">=</span> (<span class="dv">0</span>, <span class="dv">255</span>, <span class="dv">0</span>)</span>
<span id="cb9-557"><a href="#cb9-557" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb9-558"><a href="#cb9-558" aria-hidden="true" tabindex="-1"></a>                    colourcode <span class="op">=</span> (<span class="dv">255</span>, <span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb9-559"><a href="#cb9-559" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb9-560"><a href="#cb9-560" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> keypoint_idx, keypoint <span class="kw">in</span> <span class="bu">enumerate</span>(person_keypoints):</span>
<span id="cb9-561"><a href="#cb9-561" aria-hidden="true" tabindex="-1"></a>                    x, y <span class="op">=</span> keypoint</span>
<span id="cb9-562"><a href="#cb9-562" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb9-563"><a href="#cb9-563" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># Write to CSV</span></span>
<span id="cb9-564"><a href="#cb9-564" aria-hidden="true" tabindex="-1"></a>                    csv_writer.writerow([frame_count, person_idx, keypoint_idx, x.item(), y.item()])</span>
<span id="cb9-565"><a href="#cb9-565" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb9-566"><a href="#cb9-566" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># Draw keypoint on the frame</span></span>
<span id="cb9-567"><a href="#cb9-567" aria-hidden="true" tabindex="-1"></a>                    cv2.circle(annotated_frame, (<span class="bu">int</span>(x), <span class="bu">int</span>(y)), <span class="dv">5</span>, colourcode, <span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb9-568"><a href="#cb9-568" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb9-569"><a href="#cb9-569" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Draw skeleton</span></span>
<span id="cb9-570"><a href="#cb9-570" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> connection <span class="kw">in</span> skeleton:</span>
<span id="cb9-571"><a href="#cb9-571" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> connection[<span class="dv">0</span>] <span class="op">&lt;</span> <span class="bu">len</span>(person_keypoints) <span class="kw">and</span> connection[<span class="dv">1</span>] <span class="op">&lt;</span> <span class="bu">len</span>(person_keypoints):</span>
<span id="cb9-572"><a href="#cb9-572" aria-hidden="true" tabindex="-1"></a>                        start_point <span class="op">=</span> <span class="bu">tuple</span>(<span class="bu">map</span>(<span class="bu">int</span>, person_keypoints[connection[<span class="dv">0</span>]]))</span>
<span id="cb9-573"><a href="#cb9-573" aria-hidden="true" tabindex="-1"></a>                        end_point <span class="op">=</span> <span class="bu">tuple</span>(<span class="bu">map</span>(<span class="bu">int</span>, person_keypoints[connection[<span class="dv">1</span>]]))</span>
<span id="cb9-574"><a href="#cb9-574" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> <span class="bu">all</span>(start_point) <span class="kw">and</span> <span class="bu">all</span>(end_point):  <span class="co"># Check if both points are valid</span></span>
<span id="cb9-575"><a href="#cb9-575" aria-hidden="true" tabindex="-1"></a>                            cv2.line(annotated_frame, start_point, end_point, (<span class="dv">255</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="dv">2</span>)</span>
<span id="cb9-576"><a href="#cb9-576" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-577"><a href="#cb9-577" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Write the frame to the output video</span></span>
<span id="cb9-578"><a href="#cb9-578" aria-hidden="true" tabindex="-1"></a>            out.write(annotated_frame)</span>
<span id="cb9-579"><a href="#cb9-579" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-580"><a href="#cb9-580" aria-hidden="true" tabindex="-1"></a>        frame_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb9-581"><a href="#cb9-581" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-582"><a href="#cb9-582" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Release everything</span></span>
<span id="cb9-583"><a href="#cb9-583" aria-hidden="true" tabindex="-1"></a>    cap.release()</span>
<span id="cb9-584"><a href="#cb9-584" aria-hidden="true" tabindex="-1"></a>    out.release()</span>
<span id="cb9-585"><a href="#cb9-585" aria-hidden="true" tabindex="-1"></a>    cv2.destroyAllWindows()</span>
<span id="cb9-586"><a href="#cb9-586" aria-hidden="true" tabindex="-1"></a>    csv_file.close()</span>
<span id="cb9-587"><a href="#cb9-587" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Output video saved as </span><span class="sc">{</span>output_path<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb9-588"><a href="#cb9-588" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Keypoints data saved as </span><span class="sc">{</span>csv_path<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb9-589"><a href="#cb9-589" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb9-590"><a href="#cb9-590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-591"><a href="#cb9-591" aria-hidden="true" tabindex="-1"></a>Here is an example of the output video with annotated keypoints and skeletons. The green points indicate accepted keypoints, while the red points indicate filtered ones. The blue lines connect the keypoints to form a skeleton.</span>
<span id="cb9-592"><a href="#cb9-592" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-593"><a href="#cb9-593" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">html</span><span class="dt">&gt;</span></span>
<span id="cb9-594"><a href="#cb9-594" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">video</span><span class="ot"> width</span><span class="op">=</span><span class="st">"300"</span><span class="ot"> height</span><span class="op">=</span><span class="st">"200"</span><span class="ot"> controls</span><span class="dt">&gt;</span></span>
<span id="cb9-595"><a href="#cb9-595" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">source</span><span class="ot"> src</span><span class="op">=</span><span class="st">"./images/videosrerendered/sample.mp4"</span><span class="ot"> type</span><span class="op">=</span><span class="st">"video/mp4"</span><span class="dt">&gt;</span></span>
<span id="cb9-596"><a href="#cb9-596" aria-hidden="true" tabindex="-1"></a>  Your browser does not support the video tag.</span>
<span id="cb9-597"><a href="#cb9-597" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">video</span><span class="dt">&gt;</span></span>
<span id="cb9-598"><a href="#cb9-598" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">html</span><span class="dt">&gt;</span></span>
<span id="cb9-599"><a href="#cb9-599" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-600"><a href="#cb9-600" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-601"><a href="#cb9-601" aria-hidden="true" tabindex="-1"></a>Here is an example of the output csv file containing the coordinates of the keypoints. The CSV file contains the following columns: frame number, person ID, keypoint ID, x-coordinate, and y-coordinate. Each row corresponds to a detected keypoint in a specific frame.</span>
<span id="cb9-602"><a href="#cb9-602" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-603"><a href="#cb9-603" aria-hidden="true" tabindex="-1"></a><span class="in">```{python, code_folding="hide"}</span></span>
<span id="cb9-604"><a href="#cb9-604" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb9-605"><a href="#cb9-605" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> glob <span class="im">as</span> glob</span>
<span id="cb9-606"><a href="#cb9-606" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-607"><a href="#cb9-607" aria-hidden="true" tabindex="-1"></a>folderstep1output <span class="op">=</span> <span class="st">"./datatracked_afterSTEP1/"</span></span>
<span id="cb9-608"><a href="#cb9-608" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the CSV file</span></span>
<span id="cb9-609"><a href="#cb9-609" aria-hidden="true" tabindex="-1"></a>csv_file <span class="op">=</span> glob.glob(folderstep1output <span class="op">+</span> <span class="st">"*.csv"</span>)[<span class="dv">0</span>]</span>
<span id="cb9-610"><a href="#cb9-610" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(csv_file)</span>
<span id="cb9-611"><a href="#cb9-611" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-612"><a href="#cb9-612" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the first few rows of the DataFrame</span></span>
<span id="cb9-613"><a href="#cb9-613" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.head())</span>
<span id="cb9-614"><a href="#cb9-614" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb9-615"><a href="#cb9-615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-616"><a href="#cb9-616" aria-hidden="true" tabindex="-1"></a><span class="fu">## Step 2: Timeseries preparation and flat data for statistics</span></span>
<span id="cb9-617"><a href="#cb9-617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-618"><a href="#cb9-618" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-619"><a href="#cb9-619" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-620"><a href="#cb9-620" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-621"><a href="#cb9-621" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-622"><a href="#cb9-622" aria-hidden="true" tabindex="-1"></a><span class="fu"># Statistical analysis on smoothness derived from timeseries analysis (R)</span></span>
<span id="cb9-623"><a href="#cb9-623" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-624"><a href="#cb9-624" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE, code_folding="hide"}</span></span>
<span id="cb9-625"><a href="#cb9-625" aria-hidden="true" tabindex="-1"></a><span class="co"># manually edited this CSV</span></span>
<span id="cb9-626"><a href="#cb9-626" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"C:/Users/wiltshir/GitHub/InterPerDynPipelineAnalysis/Re_ Behavioral Dynamics in Social Interactions AP_SI/smoothness_data_top_view_clean.csv"</span>) </span>
<span id="cb9-627"><a href="#cb9-627" aria-hidden="true" tabindex="-1"></a><span class="co">#data_cross_cultur&lt;-data[1:18,]</span></span>
<span id="cb9-628"><a href="#cb9-628" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-629"><a href="#cb9-629" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove a row</span></span>
<span id="cb9-630"><a href="#cb9-630" aria-hidden="true" tabindex="-1"></a>data<span class="ot">&lt;-</span> <span class="fu">subset</span>(data, data<span class="sc">$</span>videoID<span class="sc">!=</span><span class="st">"cop_b09 z góry"</span>)</span>
<span id="cb9-631"><a href="#cb9-631" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-632"><a href="#cb9-632" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a culture grouping variable</span></span>
<span id="cb9-633"><a href="#cb9-633" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>culture <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">grepl</span>(<span class="st">"góry$"</span>, data<span class="sc">$</span>videoID), <span class="st">"Yurakare"</span>,</span>
<span id="cb9-634"><a href="#cb9-634" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">ifelse</span>(<span class="fu">grepl</span>(<span class="st">"kam_5$"</span>, data<span class="sc">$</span>videoID), <span class="st">"Polish"</span>, <span class="cn">NA</span>))</span>
<span id="cb9-635"><a href="#cb9-635" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-636"><a href="#cb9-636" aria-hidden="true" tabindex="-1"></a><span class="co"># Restructure data into long format</span></span>
<span id="cb9-637"><a href="#cb9-637" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb9-638"><a href="#cb9-638" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-639"><a href="#cb9-639" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb9-640"><a href="#cb9-640" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-641"><a href="#cb9-641" aria-hidden="true" tabindex="-1"></a>data_long <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb9-642"><a href="#cb9-642" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(smoothness_p1_proximity, smoothness_p2_proximity),</span>
<span id="cb9-643"><a href="#cb9-643" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"person"</span>,</span>
<span id="cb9-644"><a href="#cb9-644" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"smoothness_value"</span>)</span>
<span id="cb9-645"><a href="#cb9-645" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-646"><a href="#cb9-646" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lme4) </span>
<span id="cb9-647"><a href="#cb9-647" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lmerTest) </span>
<span id="cb9-648"><a href="#cb9-648" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-649"><a href="#cb9-649" aria-hidden="true" tabindex="-1"></a>model1 <span class="ot">&lt;-</span> <span class="fu">lmer</span>(smoothness_value <span class="sc">~</span> culture <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> videoID), <span class="at">data =</span> data_long)</span>
<span id="cb9-650"><a href="#cb9-650" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-651"><a href="#cb9-651" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model1)</span>
<span id="cb9-652"><a href="#cb9-652" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb9-653"><a href="#cb9-653" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-654"><a href="#cb9-654" aria-hidden="true" tabindex="-1"></a><span class="fu"># Statistical analysis on measures derived from non-linear time series analysis</span></span>
<span id="cb9-655"><a href="#cb9-655" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-656"><a href="#cb9-656" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-657"><a href="#cb9-657" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-658"><a href="#cb9-658" aria-hidden="true" tabindex="-1"></a><span class="fu"># References</span></span></code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>